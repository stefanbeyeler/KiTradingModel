<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KI Trading Model - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
            margin-bottom: 1.5rem;
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .header-status {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            align-items: center;
        }

        .header-status span {
            padding: 0.4rem 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        .header-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(16, 185, 129, 0.2));
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.4);
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15);
        }

        .header-btn:hover {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.4), rgba(16, 185, 129, 0.3));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 1400px) {
            .services-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 1200px) {
            .services-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .services-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .services-grid {
                grid-template-columns: 1fr;
            }
        }

        .service-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            min-height: 280px;
        }

        .service-card:hover {
            transform: translateY(-3px);
            border-color: rgba(100, 200, 255, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .service-card h2 {
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-healthy {
            background: rgba(76, 175, 80, 0.2);
            color: #81c784;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .status-unhealthy {
            background: rgba(244, 67, 54, 0.2);
            color: #e57373;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .status-loading {
            background: rgba(255, 193, 7, 0.2);
            color: #ffd54f;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .service-card p {
            opacity: 0.8;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .service-info {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 1rem;
            font-size: 0.8rem;
            flex-shrink: 0;
            margin-top: auto;
        }

        .service-info div {
            display: flex;
            justify-content: space-between;
            padding: 0.3rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .service-info div:last-child {
            border-bottom: none;
        }

        .service-info .label {
            opacity: 0.6;
        }

        .service-links {
            display: flex;
            gap: 0.4rem;
            flex-wrap: nowrap;
            flex-shrink: 0;
        }

        .service-links a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.4rem 0.5rem;
            background: rgba(100, 200, 255, 0.1);
            color: #64c8ff;
            border-radius: 5px;
            text-decoration: none;
            font-size: 0.75rem;
            transition: all 0.2s;
            border: 1px solid rgba(100, 200, 255, 0.2);
            white-space: nowrap;
        }

        .service-links a:hover {
            background: rgba(100, 200, 255, 0.2);
            transform: translateY(-1px);
        }

        /* System Resources Section Styles */
        .system-resources-section {
            margin-bottom: 1.5rem;
        }

        .system-resources-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .system-resources-card h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .resources-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 1400px) {
            .resources-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 1000px) {
            .resources-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .resources-grid {
                grid-template-columns: 1fr;
            }
        }

        .resource-panel {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 1rem;
        }

        .resource-panel h4 {
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metric-icon {
            font-size: 1.1rem;
        }

        .metric-bar-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 0.6rem;
            position: relative;
        }

        .metric-bar {
            height: 100%;
            border-radius: 8px;
            transition: width 0.5s ease, background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 0.7rem;
            font-weight: 600;
            min-width: 35px;
        }

        .metric-bar.cpu {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
        }

        .metric-bar.memory {
            background: linear-gradient(90deg, #8b5cf6, #a78bfa);
        }

        .metric-bar.gpu {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .metric-bar.gpu-memory {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        .metric-bar.disk {
            background: linear-gradient(90deg, #06b6d4, #22d3ee);
        }

        .metric-bar.power {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        .metric-bar.high {
            background: linear-gradient(90deg, #ef4444, #f87171) !important;
        }

        .metric-bar.medium {
            background: linear-gradient(90deg, #f59e0b, #fbbf24) !important;
        }

        .resource-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.4rem;
            font-size: 0.75rem;
        }

        .resource-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 0.4rem 0.3rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .resource-stat .value {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 0.15rem;
        }

        .resource-stat .label {
            opacity: 0.6;
            font-size: 0.65rem;
        }

        .resource-stat.full-width {
            grid-column: span 2;
        }

        .temp-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .temp-indicator.cool { color: #34d399; }
        .temp-indicator.warm { color: #fbbf24; }
        .temp-indicator.hot { color: #f87171; }

        .power-indicator {
            color: #60a5fa;
            font-weight: 600;
        }

        /* Storage Details Row */
        .storage-details-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        @media (max-width: 900px) {
            .storage-details-row {
                grid-template-columns: 1fr;
            }
        }

        .storage-volumes {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 1rem;
        }

        .storage-volumes h4 {
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .volume-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .volume-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0.7rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .volume-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(100, 200, 255, 0.2);
        }

        .volume-name {
            font-weight: 500;
            color: #e8e8e8;
        }

        .volume-size {
            font-size: 0.7rem;
            opacity: 0.6;
        }

        .storage-loading {
            text-align: center;
            padding: 1.5rem;
            opacity: 0.5;
            font-size: 0.85rem;
        }

        /* Service Resource Info in Cards */
        .service-resources {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.4rem;
            margin-top: 0.5rem;
            margin-bottom: 0.8rem;
            padding-top: 0.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .service-resource {
            text-align: center;
            padding: 0.3rem;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 4px;
            font-size: 0.7rem;
        }

        .service-resource .value {
            font-weight: 600;
            font-size: 0.8rem;
            display: block;
        }

        .service-resource .label {
            opacity: 0.6;
            font-size: 0.65rem;
        }

        .service-resource.cpu .value { color: #60a5fa; }
        .service-resource.ram .value { color: #a78bfa; }
        .service-resource.net .value { color: #34d399; }

        /* Data Flow Diagram Styles - Horizontal Layout */
        .dataflow-section {
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
        }

        .dataflow-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex: 1;
        }

        /* Watchdog Panel neben Datenfluss */
        .watchdog-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            border: 1px solid rgba(236, 72, 153, 0.3);
            min-width: 280px;
            max-width: 320px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        .watchdog-panel h3 {
            font-size: 1rem;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #ec4899;
        }

        .watchdog-panel .watchdog-status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .watchdog-panel .watchdog-status-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .watchdog-panel .watchdog-status-badge.healthy {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .watchdog-panel .watchdog-status-badge.unhealthy {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .watchdog-panel .watchdog-status-badge.loading {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .watchdog-stats {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .watchdog-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0.6rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            font-size: 0.75rem;
        }

        .watchdog-stat .stat-label {
            opacity: 0.7;
        }

        .watchdog-stat .stat-value {
            font-weight: 600;
        }

        .watchdog-stat .stat-value.healthy {
            color: #10b981;
        }

        .watchdog-stat .stat-value.warning {
            color: #f59e0b;
        }

        .watchdog-stat .stat-value.error {
            color: #ef4444;
        }

        .watchdog-services-mini {
            margin-top: 0.8rem;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.3rem;
        }

        .watchdog-service-dot {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.3rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            font-size: 0.55rem;
        }

        .watchdog-service-dot .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-bottom: 0.2rem;
        }

        .watchdog-service-dot .dot.healthy {
            background: #10b981;
            box-shadow: 0 0 4px rgba(16, 185, 129, 0.6);
        }

        .watchdog-service-dot .dot.unhealthy {
            background: #ef4444;
            box-shadow: 0 0 4px rgba(239, 68, 68, 0.6);
        }

        .watchdog-service-dot .dot.loading {
            background: #f59e0b;
            animation: pulse-status 1.5s ease-in-out infinite;
        }

        .watchdog-panel-links {
            margin-top: 1rem;
            padding-top: 0.8rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 0.5rem;
        }

        .watchdog-panel-links a {
            flex: 1;
            text-align: center;
            padding: 0.4rem 0.6rem;
            background: rgba(236, 72, 153, 0.15);
            border: 1px solid rgba(236, 72, 153, 0.3);
            border-radius: 6px;
            color: #ec4899;
            font-size: 0.7rem;
            text-decoration: none;
            transition: all 0.2s;
        }

        .watchdog-panel-links a:hover {
            background: rgba(236, 72, 153, 0.25);
            transform: translateY(-1px);
        }

        @media (max-width: 1400px) {
            .dataflow-section {
                flex-direction: column;
            }
            .watchdog-panel {
                max-width: none;
            }
            .watchdog-services-mini {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        .dataflow-card h3 {
            font-size: 1rem;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dataflow-diagram {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem;
            overflow-x: auto;
        }

        .dataflow-stage {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
        }

        .dataflow-stage-label {
            font-size: 0.55rem;
            opacity: 0.5;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.2rem;
        }

        .dataflow-nodes-vertical {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .dataflow-node {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 0.4rem 0.6rem;
            text-align: center;
            min-width: 70px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 0.4rem;
        }

        .dataflow-node:hover {
            transform: scale(1.02);
            border-color: rgba(100, 200, 255, 0.5);
            box-shadow: 0 2px 8px rgba(100, 200, 255, 0.2);
        }

        .dataflow-node.external {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .dataflow-node.gateway {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.15);
        }

        .dataflow-node.ml {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }

        .dataflow-node.analysis {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .dataflow-node.output {
            border-color: #06b6d4;
            background: rgba(6, 182, 212, 0.1);
        }

        .dataflow-node.monitoring {
            border-color: #ec4899;
            background: rgba(236, 72, 153, 0.1);
        }

        .dataflow-node .node-icon {
            font-size: 1rem;
        }

        .dataflow-node .node-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
        }

        .dataflow-node .node-name {
            font-size: 0.65rem;
            font-weight: 600;
            line-height: 1.2;
        }

        .dataflow-node .node-port {
            font-size: 0.5rem;
            opacity: 0.6;
        }

        .dataflow-node .node-status {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 1.5px solid rgba(0, 0, 0, 0.3);
            background: #6b7280;
        }

        .dataflow-node .node-status.healthy {
            background: #10b981;
            box-shadow: 0 0 4px rgba(16, 185, 129, 0.6);
        }

        .dataflow-node .node-status.unhealthy {
            background: #ef4444;
            box-shadow: 0 0 4px rgba(239, 68, 68, 0.6);
        }

        .dataflow-node .node-status.loading {
            background: #f59e0b;
            animation: pulse-status 1.5s ease-in-out infinite;
        }

        @keyframes pulse-status {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .dataflow-arrow {
            color: rgba(255, 255, 255, 0.3);
            font-size: 1rem;
            display: flex;
            align-items: center;
            padding: 0 0.2rem;
        }

        @media (max-width: 1200px) {
            .dataflow-diagram {
                flex-wrap: wrap;
                justify-content: center;
            }
            .dataflow-stage {
                margin-bottom: 0.5rem;
            }
        }

        @media (max-width: 768px) {
            .dataflow-node {
                min-width: 60px;
                padding: 0.3rem 0.5rem;
            }
            .dataflow-node .node-name {
                font-size: 0.6rem;
            }
            .dataflow-node .node-icon {
                font-size: 0.85rem;
            }
        }

        footer {
            text-align: center;
            padding: 1.5rem;
            opacity: 0.5;
            font-size: 0.8rem;
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 8px;
            border-left: 4px solid #64c8ff;
            display: none;
            z-index: 1000;
        }

        .toast.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-overlay.show {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #e8e8e8;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #e8e8e8;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .category-group {
            margin-bottom: 1.5rem;
        }

        .category-group:last-child {
            margin-bottom: 0;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .category-icon {
            font-size: 1.2rem;
        }

        .category-name {
            font-size: 1rem;
            font-weight: 600;
            color: #64c8ff;
        }

        .category-count {
            background: rgba(100, 200, 255, 0.2);
            color: #64c8ff;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .symbols-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .symbol-chip {
            background: rgba(255, 255, 255, 0.08);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.8rem;
            color: #e8e8e8;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s;
        }

        .symbol-chip:hover {
            background: rgba(100, 200, 255, 0.15);
            border-color: rgba(100, 200, 255, 0.3);
        }

        .modal-summary {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .summary-stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            text-align: center;
            min-width: 100px;
        }

        .summary-stat .value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #64c8ff;
        }

        .summary-stat .label {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }

        .clickable-symbol-count {
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px;
            padding: 0.15rem 0.5rem;
            margin: 0 -4px;
            background: rgba(100, 200, 255, 0.1);
            border: 1px solid rgba(100, 200, 255, 0.2);
            color: #64c8ff;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .clickable-symbol-count::after {
            content: '\25B6';
            font-size: 0.6rem;
            opacity: 0.7;
        }

        .clickable-symbol-count:hover {
            background: rgba(100, 200, 255, 0.25);
            border-color: rgba(100, 200, 255, 0.4);
            color: #fff;
            transform: translateX(2px);
        }

        .clickable-symbol-count:hover::after {
            opacity: 1;
        }

        .modal-loading {
            text-align: center;
            padding: 3rem;
            color: #64c8ff;
        }

        .modal-loading .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(100, 200, 255, 0.2);
            border-top-color: #64c8ff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Training Section Styles */
        .training-section {
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #fb923c;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(249, 115, 22, 0.3);
        }

        .section-icon {
            font-size: 1.2rem;
        }

        .training-grid {
            margin-bottom: 0;
        }

        .training-card {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.15), rgba(249, 115, 22, 0.05)) !important;
            border-color: rgba(249, 115, 22, 0.3) !important;
        }

        .training-card:hover {
            border-color: rgba(249, 115, 22, 0.5) !important;
            box-shadow: 0 10px 40px rgba(249, 115, 22, 0.2) !important;
        }

        .training-link {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.3), rgba(249, 115, 22, 0.15)) !important;
            color: #fb923c !important;
            border-color: rgba(249, 115, 22, 0.4) !important;
        }

        .training-link:hover {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.4), rgba(249, 115, 22, 0.25)) !important;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>KI Trading Model</h1>
            <div class="header-status">
                <span id="last-update">Update: -</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Data Flow Diagram - Horizontal -->
        <div class="dataflow-section">
            <div class="dataflow-card">
                <h3><span class="metric-icon">&#128260;</span> Datenfluss Architektur</h3>
                <div class="dataflow-diagram">
                    <!-- External Sources Stage -->
                    <div class="dataflow-stage">
                        <span class="dataflow-stage-label">Extern</span>
                        <div class="dataflow-nodes-vertical">
                            <div class="dataflow-node external">
                                <span class="node-status loading" id="df-easyinsight-status"></span>
                                <span class="node-icon">&#127760;</span>
                                <div class="node-info">
                                    <span class="node-name">EasyInsight</span>
                                    <span class="node-port">TimescaleDB</span>
                                </div>
                            </div>
                            <div class="dataflow-node external">
                                <span class="node-status loading" id="df-twelvedata-status"></span>
                                <span class="node-icon">&#128200;</span>
                                <div class="node-info">
                                    <span class="node-name">TwelveData</span>
                                    <span class="node-port">Fallback 1</span>
                                </div>
                            </div>
                            <div class="dataflow-node external">
                                <span class="node-status loading" id="df-yahoo-status"></span>
                                <span class="node-icon">&#128176;</span>
                                <div class="node-info">
                                    <span class="node-name">Yahoo Finance</span>
                                    <span class="node-port">Fallback 2</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dataflow-arrow">&#8594;</div>

                    <!-- Gateway Stage -->
                    <div class="dataflow-stage">
                        <span class="dataflow-stage-label">Gateway</span>
                        <div class="dataflow-nodes-vertical">
                            <div class="dataflow-node gateway">
                                <span class="node-status loading" id="df-data-status"></span>
                                <span class="node-icon">&#128279;</span>
                                <div class="node-info">
                                    <span class="node-name">Data Service</span>
                                    <span class="node-port">:3001</span>
                                </div>
                            </div>
                            <div class="dataflow-node gateway" style="border-color: #dc2626; background: rgba(220, 38, 38, 0.1);">
                                <span class="node-status loading" id="df-redis-status"></span>
                                <span class="node-icon">&#128451;</span>
                                <div class="node-info">
                                    <span class="node-name">Redis Cache</span>
                                    <span class="node-port">:6379</span>
                                </div>
                            </div>
                            <span class="dataflow-stage-label" style="margin-top: 0.3rem;">Training</span>
                            <div class="dataflow-node training" style="border-color: #f97316; background: rgba(249, 115, 22, 0.1);">
                                <span class="node-status loading" id="df-candlestick-train-status"></span>
                                <span class="node-icon">&#127891;</span>
                                <div class="node-info">
                                    <span class="node-name">Candle-Train</span>
                                    <span class="node-port">:3016</span>
                                </div>
                            </div>
                            <div class="dataflow-node training" style="border-color: #f97316; background: rgba(249, 115, 22, 0.1);">
                                <span class="node-status loading" id="df-cnn-lstm-train-status"></span>
                                <span class="node-icon">&#127891;</span>
                                <div class="node-info">
                                    <span class="node-name">CNN-LSTM-Train</span>
                                    <span class="node-port">:3017</span>
                                </div>
                            </div>
                            <div class="dataflow-node training" style="border-color: #f97316; background: rgba(249, 115, 22, 0.1);">
                                <span class="node-status loading" id="df-hmm-train-status"></span>
                                <span class="node-icon">&#127891;</span>
                                <div class="node-info">
                                    <span class="node-name">HMM-Train</span>
                                    <span class="node-port">:3014</span>
                                </div>
                            </div>
                            <div class="dataflow-node training" style="border-color: #f97316; background: rgba(249, 115, 22, 0.1);">
                                <span class="node-status loading" id="df-nhits-train-status"></span>
                                <span class="node-icon">&#127891;</span>
                                <div class="node-info">
                                    <span class="node-name">NHITS-Train</span>
                                    <span class="node-port">:3012</span>
                                </div>
                            </div>
                            <div class="dataflow-node training" style="border-color: #f97316; background: rgba(249, 115, 22, 0.1);">
                                <span class="node-status loading" id="df-tcn-train-status"></span>
                                <span class="node-icon">&#127891;</span>
                                <div class="node-info">
                                    <span class="node-name">TCN-Train</span>
                                    <span class="node-port">:3013</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dataflow-arrow">&#8594;</div>

                    <!-- ML Services Stage -->
                    <div class="dataflow-stage">
                        <span class="dataflow-stage-label">ML Inference</span>
                        <div class="dataflow-nodes-vertical">
                            <div class="dataflow-node ml">
                                <span class="node-status loading" id="df-candlestick-status"></span>
                                <span class="node-icon">&#128293;</span>
                                <div class="node-info">
                                    <span class="node-name">Candlestick</span>
                                    <span class="node-port">:3006</span>
                                </div>
                            </div>
                            <div class="dataflow-node ml">
                                <span class="node-status loading" id="df-cnn-lstm-status"></span>
                                <span class="node-icon">&#129516;</span>
                                <div class="node-info">
                                    <span class="node-name">CNN-LSTM</span>
                                    <span class="node-port">:3007</span>
                                </div>
                            </div>
                            <div class="dataflow-node ml">
                                <span class="node-status loading" id="df-embedder-status"></span>
                                <span class="node-icon">&#129302;</span>
                                <div class="node-info">
                                    <span class="node-name">Embedder</span>
                                    <span class="node-port">:3005</span>
                                </div>
                            </div>
                            <div class="dataflow-node ml">
                                <span class="node-status loading" id="df-hmm-status"></span>
                                <span class="node-icon">&#128201;</span>
                                <div class="node-info">
                                    <span class="node-name">HMM</span>
                                    <span class="node-port">:3004</span>
                                </div>
                            </div>
                            <div class="dataflow-node ml">
                                <span class="node-status loading" id="df-nhits-status"></span>
                                <span class="node-icon">&#128202;</span>
                                <div class="node-info">
                                    <span class="node-name">NHITS</span>
                                    <span class="node-port">:3002</span>
                                </div>
                            </div>
                            <div class="dataflow-node ml">
                                <span class="node-status loading" id="df-tcn-status"></span>
                                <span class="node-icon">&#128200;</span>
                                <div class="node-info">
                                    <span class="node-name">TCN</span>
                                    <span class="node-port">:3003</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dataflow-arrow">&#8594;</div>

                    <!-- Analysis Stage -->
                    <div class="dataflow-stage">
                        <span class="dataflow-stage-label">Analyse</span>
                        <div class="dataflow-nodes-vertical">
                            <div class="dataflow-node analysis">
                                <span class="node-status loading" id="df-rag-status"></span>
                                <span class="node-icon">&#128269;</span>
                                <div class="node-info">
                                    <span class="node-name">RAG</span>
                                    <span class="node-port">:3008</span>
                                </div>
                            </div>
                            <div class="dataflow-node analysis">
                                <span class="node-status loading" id="df-llm-status"></span>
                                <span class="node-icon">&#129504;</span>
                                <div class="node-info">
                                    <span class="node-name">LLM</span>
                                    <span class="node-port">:3009</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dataflow-arrow">&#8594;</div>

                    <!-- Output Stage -->
                    <div class="dataflow-stage">
                        <span class="dataflow-stage-label">Output</span>
                        <div class="dataflow-nodes-vertical">
                            <div class="dataflow-node output">
                                <span class="node-status healthy" id="df-frontend-status"></span>
                                <span class="node-icon">&#128187;</span>
                                <div class="node-info">
                                    <span class="node-name">Frontend</span>
                                    <span class="node-port">:3000</span>
                                </div>
                            </div>
                            <div class="dataflow-node monitoring">
                                <span class="node-status loading" id="df-watchdog-status"></span>
                                <span class="node-icon">&#128065;</span>
                                <div class="node-info">
                                    <span class="node-name">Watchdog</span>
                                    <span class="node-port">:3010</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Watchdog Panel -->
            <div class="watchdog-panel">
                <h3><span class="metric-icon">&#128065;</span> Watchdog</h3>
                <div class="watchdog-status-header">
                    <span>Service Status</span>
                    <span class="watchdog-status-badge loading" id="wp-watchdog-status">Laden...</span>
                </div>
                <div class="watchdog-stats">
                    <div class="watchdog-stat">
                        <span class="stat-label">Port</span>
                        <span class="stat-value">3010</span>
                    </div>
                    <div class="watchdog-stat">
                        <span class="stat-label">Services Online</span>
                        <span class="stat-value" id="wp-services-online">-</span>
                    </div>
                    <div class="watchdog-stat">
                        <span class="stat-label">Telegram</span>
                        <span class="stat-value" id="wp-telegram-status">-</span>
                    </div>
                    <div class="watchdog-stat">
                        <span class="stat-label">Letzte Pruefung</span>
                        <span class="stat-value" id="wp-last-check">-</span>
                    </div>
                </div>
                <div class="watchdog-services-mini">
                    <div class="watchdog-service-dot">
                        <span class="dot loading" id="wp-dot-data"></span>
                        <span>Data</span>
                    </div>
                    <div class="watchdog-service-dot">
                        <span class="dot loading" id="wp-dot-nhits"></span>
                        <span>NHITS</span>
                    </div>
                    <div class="watchdog-service-dot">
                        <span class="dot loading" id="wp-dot-tcn"></span>
                        <span>TCN</span>
                    </div>
                    <div class="watchdog-service-dot">
                        <span class="dot loading" id="wp-dot-hmm"></span>
                        <span>HMM</span>
                    </div>
                    <div class="watchdog-service-dot">
                        <span class="dot loading" id="wp-dot-embedder"></span>
                        <span>Embed</span>
                    </div>
                    <div class="watchdog-service-dot">
                        <span class="dot loading" id="wp-dot-candlestick"></span>
                        <span>Candle</span>
                    </div>
                    <div class="watchdog-service-dot">
                        <span class="dot loading" id="wp-dot-cnn-lstm"></span>
                        <span>LSTM</span>
                    </div>
                    <div class="watchdog-service-dot">
                        <span class="dot loading" id="wp-dot-rag"></span>
                        <span>RAG</span>
                    </div>
                    <div class="watchdog-service-dot">
                        <span class="dot loading" id="wp-dot-llm"></span>
                        <span>LLM</span>
                    </div>
                    <div class="watchdog-service-dot">
                        <span class="dot loading" id="wp-dot-redis"></span>
                        <span>Redis</span>
                    </div>
                </div>
                <div class="watchdog-panel-links">
                    <a href="/service-watchdog.html" target="_blank">Info</a>
                    <a href="/watchdog/docs" target="_blank">API Docs</a>
                    <a href="/config-watchdog.html" target="_blank">Config</a>
                </div>
            </div>
        </div>

        <!-- System Resources Section (Combined CPU, GPU, Storage) -->
        <div class="system-resources-section">
            <div class="system-resources-card">
                <h3><span class="metric-icon">&#9881;</span> System-Ressourcen (Jetson AGX Thor)</h3>

                <!-- Main Resources Grid -->
                <div class="resources-grid">
                    <!-- CPU Panel -->
                    <div class="resource-panel">
                        <h4><span class="metric-icon">&#128187;</span> CPU</h4>
                        <div class="metric-bar-container">
                            <div class="metric-bar cpu" id="cpu-bar" style="width: 0%">
                                <span id="cpu-percent">-</span>
                            </div>
                        </div>
                        <div class="resource-stats">
                            <div class="resource-stat">
                                <span class="value" id="cpu-cores">-</span>
                                <span class="label">Kerne</span>
                            </div>
                            <div class="resource-stat">
                                <span class="value temp-indicator" id="cpu-temp">-</span>
                                <span class="label">Temp</span>
                            </div>
                        </div>
                    </div>

                    <!-- GPU Panel -->
                    <div class="resource-panel" id="gpu-panel">
                        <h4><span class="metric-icon">&#127918;</span> GPU</h4>
                        <div id="gpu-content">
                            <div class="metric-bar-container">
                                <div class="metric-bar gpu" id="gpu-util-bar" style="width: 0%">
                                    <span id="gpu-util-percent">-</span>
                                </div>
                            </div>
                            <div class="resource-stats">
                                <div class="resource-stat">
                                    <span class="value" id="gpu-vram">-</span>
                                    <span class="label">VRAM</span>
                                </div>
                                <div class="resource-stat">
                                    <span class="value temp-indicator" id="gpu-temp">-</span>
                                    <span class="label">Temp</span>
                                </div>
                            </div>
                        </div>
                        <div id="gpu-unavailable" class="storage-loading" style="display: none;">
                            Keine GPU
                        </div>
                    </div>

                    <!-- Shared VRAM Panel -->
                    <div class="resource-panel">
                        <h4><span class="metric-icon">&#128204;</span> Shared VRAM</h4>
                        <div class="metric-bar-container">
                            <div class="metric-bar memory" id="memory-bar" style="width: 0%">
                                <span id="memory-percent">-</span>
                            </div>
                        </div>
                        <div class="resource-stats">
                            <div class="resource-stat">
                                <span class="value" id="memory-total">-</span>
                                <span class="label">Gesamt</span>
                            </div>
                            <div class="resource-stat">
                                <span class="value" id="memory-used">-</span>
                                <span class="label">Belegt</span>
                            </div>
                        </div>
                    </div>

                    <!-- Storage Panel -->
                    <div class="resource-panel">
                        <h4><span class="metric-icon">&#128190;</span> Storage</h4>
                        <div class="metric-bar-container">
                            <div class="metric-bar disk" id="disk-bar" style="width: 0%">
                                <span id="disk-percent">-</span>
                            </div>
                        </div>
                        <div class="resource-stats">
                            <div class="resource-stat">
                                <span class="value" id="disk-total">-</span>
                                <span class="label">Gesamt</span>
                            </div>
                            <div class="resource-stat">
                                <span class="value" id="disk-free">-</span>
                                <span class="label">Frei</span>
                            </div>
                        </div>
                    </div>

                    <!-- Power Panel -->
                    <div class="resource-panel">
                        <h4><span class="metric-icon">&#9889;</span> Power</h4>
                        <div class="metric-bar-container">
                            <div class="metric-bar power" id="power-bar" style="width: 0%">
                                <span id="power-percent">-</span>
                            </div>
                        </div>
                        <div class="resource-stats">
                            <div class="resource-stat">
                                <span class="value power-indicator" id="gpu-power">-</span>
                                <span class="label">GPU</span>
                            </div>
                            <div class="resource-stat">
                                <span class="value power-indicator" id="total-power">-</span>
                                <span class="label">Gesamt</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Volumes Row -->
                <div class="storage-details-row" style="grid-template-columns: 1fr;">
                    <div class="storage-volumes">
                        <h4>&#128451; Docker Volumes</h4>
                        <div class="volume-list" id="volume-list">
                            <div class="storage-loading">Lade Volumes...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="services-grid">
            <!-- EasyInsight API -->
            <div class="service-card" id="easyinsight-card">
                <div class="service-header">
                    <h2>EasyInsight API</h2>
                    <span class="status-badge status-loading" id="easyinsight-status">Laden...</span>
                </div>
                <p>Externe Datenquelle - OHLCV-Marktdaten und Symbol-Informationen via TimescaleDB.</p>
                <div class="service-info" id="easyinsight-info">
                    <div><span class="label">Host</span><span>10.1.19.102:3000</span></div>
                    <div><span class="label">Symbole</span><span id="easyinsight-symbols" class="clickable-symbol-count" onclick="openSymbolsModal()" title="Klicken fr Details">-</span></div>
                    <div><span class="label">Latenz</span><span id="easyinsight-latency">-</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-easyinsight.html" target="_blank">Info</a>
                    <a href="http://10.1.19.102:3000/swagger/" target="_blank">API Docs</a>
                    <a href="http://10.1.19.102:3000" target="_blank">Cockpit</a>
                </div>
            </div>

            <!-- Data Service -->
            <div class="service-card" id="data-card">
                <div class="service-header">
                    <h2>Data Service</h2>
                    <span class="status-badge status-loading" id="data-status">Laden...</span>
                </div>
                <p>Symbol-Management, Trading-Strategien und Daten-Synchronisation mit EasyInsight.</p>
                <div class="service-info" id="data-info">
                    <div><span class="label">Port</span><span>3001</span></div>
                    <div><span class="label">EasyInsight</span><span id="data-easyinsight">-</span></div>
                    <div><span class="label">Sync</span><span id="data-sync">-</span></div>
                </div>
                <div class="service-resources">
                    <div class="service-resource cpu"><span class="value">2 CPU</span><span class="label">CPU Limit</span></div>
                    <div class="service-resource ram"><span class="value">4 GB</span><span class="label">RAM Limit</span></div>
                    <div class="service-resource net"><span class="value">CPU</span><span class="label">Mode</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-data.html" target="_blank">Info</a>
                    <a href="/data/docs" target="_blank">API Docs</a>
                    <a href="/config-data.html" target="_blank">Config</a>
                </div>
            </div>

            <!-- Candlestick Pattern Service (Inference) -->
            <div class="service-card" id="candlestick-card">
                <div class="service-header">
                    <h2>Candlestick-Pattern</h2>
                    <span class="status-badge status-loading" id="candlestick-status">Laden...</span>
                </div>
                <p>Candlestick Pattern Detection - Erkennung von 21 Kerzen-Mustern (Hammer, Doji, Engulfing, etc.).</p>
                <div class="service-info" id="candlestick-info">
                    <div><span class="label">Port</span><span>3006</span></div>
                    <div><span class="label">Pattern</span><span id="candlestick-patterns">21 Typen</span></div>
                    <div><span class="label">Auto-Scan</span><span id="candlestick-autoscan">-</span></div>
                </div>
                <div class="service-resources">
                    <div class="service-resource cpu"><span class="value">2 CPU</span><span class="label">CPU Limit</span></div>
                    <div class="service-resource ram"><span class="value">2 GB</span><span class="label">RAM Limit</span></div>
                    <div class="service-resource net"><span class="value">CPU</span><span class="label">Mode</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-candlestick.html" target="_blank">Info</a>
                    <a href="/candlestick/docs" target="_blank">API Docs</a>
                    
                    <a href="/config-candlestick.html" target="_blank">Config</a>
                </div>
            </div>

            <!-- HMM-Regime Service -->
            <div class="service-card" id="hmm-card">
                <div class="service-header">
                    <h2>HMM-Regime</h2>
                    <span class="status-badge status-loading" id="hmm-status">Laden...</span>
                </div>
                <p>Hidden Markov Model + LightGBM - Regime-Erkennung und Signal-Scoring fr Trading.</p>
                <div class="service-info" id="hmm-info">
                    <div><span class="label">Port</span><span>3004</span></div>
                    <div><span class="label">Regimes</span><span id="hmm-regimes">4 States</span></div>
                    <div><span class="label">Scorer</span><span id="hmm-scorer">-</span></div>
                </div>
                <div class="service-resources">
                    <div class="service-resource cpu"><span class="value">2 CPU</span><span class="label">CPU Limit</span></div>
                    <div class="service-resource ram"><span class="value">4 GB</span><span class="label">RAM Limit</span></div>
                    <div class="service-resource net"><span class="value">CPU</span><span class="label">Mode</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-hmm.html" target="_blank">Info</a>
                    <a href="/hmm/docs" target="_blank">API Docs</a>
                    <a href="/config-hmm.html" target="_blank">Config</a>
                </div>
            </div>

            <!-- NHITS Service -->
            <div class="service-card" id="nhits-card">
                <div class="service-header">
                    <h2>NHITS Service</h2>
                    <span class="status-badge status-loading" id="nhits-status">Laden...</span>
                </div>
                <p>Neural Hierarchical Interpolation for Time Series - Preisprognosen und Modell-Training.</p>
                <div class="service-info" id="nhits-info">
                    <div><span class="label">Port</span><span>3002</span></div>
                    <div><span class="label">Training</span><span id="nhits-training">-</span></div>
                </div>
                <div class="service-resources">
                    <div class="service-resource cpu"><span class="value">4 CPU</span><span class="label">CPU Limit</span></div>
                    <div class="service-resource ram"><span class="value">16 GB</span><span class="label">RAM Limit</span></div>
                    <div class="service-resource net"><span class="value">GPU</span><span class="label">Mode</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-nhits.html" target="_blank">Info</a>
                    <a href="/nhits/docs" target="_blank">API Docs</a>
                    <a href="/config-nhits.html" target="_blank">Config</a>
                </div>
            </div>

            <!-- TCN-Pattern Service (Inference) -->
            <div class="service-card" id="tcn-card">
                <div class="service-header">
                    <h2>TCN-Pattern</h2>
                    <span class="status-badge status-loading" id="tcn-status">Laden...</span>
                </div>
                <p>Temporal Convolutional Network - Erkennung von 16 Chart-Pattern Typen (Inference Only).</p>
                <div class="service-info" id="tcn-info">
                    <div><span class="label">Port</span><span>3003</span></div>
                    <div><span class="label">Pattern</span><span id="tcn-patterns">16 Typen</span></div>
                    <div><span class="label">Model</span><span id="tcn-model-status">-</span></div>
                </div>
                <div class="service-resources">
                    <div class="service-resource cpu"><span class="value">2 CPU</span><span class="label">CPU Limit</span></div>
                    <div class="service-resource ram"><span class="value">4 GB</span><span class="label">RAM Limit</span></div>
                    <div class="service-resource net"><span class="value">GPU</span><span class="label">Mode</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-tcn.html" target="_blank">Info</a>
                    <a href="/tcn/docs" target="_blank">API Docs</a>
                    <a href="/config-tcn.html" target="_blank">Config</a>
                </div>
            </div>

            <!-- CNN-LSTM Multi-Task Service (Inference) -->
            <div class="service-card" id="cnn-lstm-card">
                <div class="service-header">
                    <h2>CNN-LSTM</h2>
                    <span class="status-badge status-loading" id="cnn-lstm-status">Laden...</span>
                </div>
                <p>Hybrid CNN-LSTM Multi-Task - Preis, Pattern und Regime Vorhersagen in einem Modell.</p>
                <div class="service-info" id="cnn-lstm-info">
                    <div><span class="label">Port</span><span>3007</span></div>
                    <div><span class="label">Tasks</span><span id="cnn-lstm-tasks">3 Multi-Task</span></div>
                    <div><span class="label">Model</span><span id="cnn-lstm-model-status">-</span></div>
                </div>
                <div class="service-resources">
                    <div class="service-resource cpu"><span class="value">2 CPU</span><span class="label">CPU Limit</span></div>
                    <div class="service-resource ram"><span class="value">6 GB</span><span class="label">RAM Limit</span></div>
                    <div class="service-resource net"><span class="value">CPU</span><span class="label">Mode</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-cnn-lstm.html" target="_blank">Info</a>
                    <a href="/cnn-lstm/docs" target="_blank">API Docs</a>
                </div>
            </div>

            <!-- Embedder Service -->
            <div class="service-card" id="embedder-card">
                <div class="service-header">
                    <h2>Embedder</h2>
                    <span class="status-badge status-loading" id="embedder-status">Laden...</span>
                </div>
                <p>Zentraler Embedding-Service - Text, FinBERT, TimeSeries und Feature Embeddings.</p>
                <div class="service-info" id="embedder-info">
                    <div><span class="label">Port</span><span>3005</span></div>
                    <div><span class="label">Modelle</span><span id="embedder-models">4 Types</span></div>
                </div>
                <div class="service-resources">
                    <div class="service-resource cpu"><span class="value">2 CPU</span><span class="label">CPU Limit</span></div>
                    <div class="service-resource ram"><span class="value">12 GB</span><span class="label">RAM Limit</span></div>
                    <div class="service-resource net"><span class="value">GPU</span><span class="label">Mode</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-embedder.html" target="_blank">Info</a>
                    <a href="/embedder/docs" target="_blank">API Docs</a>
                    <a href="/config-embedder.html" target="_blank">Config</a>
                </div>
            </div>

            <!-- RAG Service -->
            <div class="service-card" id="rag-card">
                <div class="service-header">
                    <h2>RAG Service</h2>
                    <span class="status-badge status-loading" id="rag-status">Laden...</span>
                </div>
                <p>Vector Search & Knowledge Base - FAISS-basierte Dokumentensuche und Retrieval.</p>
                <div class="service-info" id="rag-info">
                    <div><span class="label">Port</span><span>3008</span></div>
                    <div><span class="label">Dokumente</span><span id="rag-docs">-</span></div>
                </div>
                <div class="service-resources">
                    <div class="service-resource cpu"><span class="value">2 CPU</span><span class="label">CPU Limit</span></div>
                    <div class="service-resource ram"><span class="value">8 GB</span><span class="label">RAM Limit</span></div>
                    <div class="service-resource net"><span class="value">GPU</span><span class="label">Mode</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-rag.html" target="_blank">Info</a>
                    <a href="/rag/docs" target="_blank">API Docs</a>
                    <a href="/config-rag.html" target="_blank">Config</a>
                </div>
            </div>

            <!-- LLM Service -->
            <div class="service-card" id="llm-card">
                <div class="service-header">
                    <h2>LLM Service</h2>
                    <span class="status-badge status-loading" id="llm-status">Laden...</span>
                </div>
                <p>Large Language Model Analyse mit RAG - Trading-Insights powered by Llama 3.1 70B.</p>
                <div class="service-info" id="llm-info">
                    <div><span class="label">Port</span><span>3009</span></div>
                    <div><span class="label">Modell</span><span id="llm-model">-</span></div>
                    <div><span class="label">RAG</span><span id="llm-rag">-</span></div>
                </div>
                <div class="service-resources">
                    <div class="service-resource cpu"><span class="value">2 CPU</span><span class="label">CPU Limit</span></div>
                    <div class="service-resource ram"><span class="value">4 GB</span><span class="label">RAM Limit</span></div>
                    <div class="service-resource net"><span class="value">GPU</span><span class="label">Mode</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-llm.html" target="_blank">Info</a>
                    <a href="/llm/docs" target="_blank">API Docs</a>
                    <a href="/config-llm.html" target="_blank">Config</a>
                </div>
            </div>

        </div>

        <!-- Training Services Section -->
        <div class="training-section">
            <h3 class="section-title"><span class="section-icon">&#127891;</span> Training Services</h3>
            <div class="services-grid training-grid">
                <!-- Candlestick Training Service -->
                <div class="service-card training-card" id="candlestick-train-card">
                    <div class="service-header">
                        <h2>Candlestick-Training</h2>
                        <span class="status-badge status-loading" id="candlestick-train-status">Laden...</span>
                    </div>
                    <p>Dedizierter Training-Container fuer Candlestick Pattern-Modelle. Low Priority.</p>
                    <div class="service-info" id="candlestick-train-info">
                        <div><span class="label">Port</span><span>3016</span></div>
                        <div><span class="label">Training</span><span id="candlestick-train-active">-</span></div>
                        <div><span class="label">Jobs</span><span id="candlestick-train-jobs">-</span></div>
                    </div>
                    <div class="service-resources">
                        <div class="service-resource cpu"><span class="value">2 CPU</span><span class="label">CPU Limit</span></div>
                        <div class="service-resource ram"><span class="value">4 GB</span><span class="label">RAM Limit</span></div>
                        <div class="service-resource net"><span class="value">LOW</span><span class="label">Priority</span></div>
                    </div>
                    <div class="service-links">
                        <a href="/service-candlestick-train.html" target="_blank">Info</a>
                        <a href="/candlestick-train/docs" target="_blank" class="training-link">API Docs</a>
                    </div>
                </div>

                <!-- HMM-Training Service -->
                <div class="service-card training-card" id="hmm-train-card">
                    <div class="service-header">
                        <h2>HMM-Training</h2>
                        <span class="status-badge status-loading" id="hmm-train-status">Laden...</span>
                    </div>
                    <p>Dedizierter Training-Container - HMM und LightGBM Scorer Modelle.</p>
                    <div class="service-info" id="hmm-train-info">
                        <div><span class="label">Port</span><span>3014</span></div>
                        <div><span class="label">Training</span><span id="hmm-train-active">-</span></div>
                        <div><span class="label">Model</span><span id="hmm-train-model">-</span></div>
                    </div>
                    <div class="service-resources">
                        <div class="service-resource cpu"><span class="value">2 CPU</span><span class="label">CPU Limit</span></div>
                        <div class="service-resource ram"><span class="value">4 GB</span><span class="label">RAM Limit</span></div>
                        <div class="service-resource net"><span class="value">LOW</span><span class="label">Priority</span></div>
                    </div>
                    <div class="service-links">
                        <a href="/service-hmm-train.html" target="_blank">Info</a>
                        <a href="/hmm-train/docs" target="_blank" class="training-link">API Docs</a>
                    </div>
                </div>

                <!-- NHITS-Training Service -->
                <div class="service-card training-card" id="nhits-train-card">
                    <div class="service-header">
                        <h2>NHITS-Training</h2>
                        <span class="status-badge status-loading" id="nhits-train-status">Laden...</span>
                    </div>
                    <p>Dedizierter Training-Container - N-HiTS Zeitreihen-Modelle. Background Training.</p>
                    <div class="service-info" id="nhits-train-info">
                        <div><span class="label">Port</span><span>3012</span></div>
                        <div><span class="label">Training</span><span id="nhits-train-active">-</span></div>
                        <div><span class="label">Jobs</span><span id="nhits-train-jobs">-</span></div>
                    </div>
                    <div class="service-resources">
                        <div class="service-resource cpu"><span class="value">4 CPU</span><span class="label">CPU Limit</span></div>
                        <div class="service-resource ram"><span class="value">16 GB</span><span class="label">RAM Limit</span></div>
                        <div class="service-resource net"><span class="value">LOW</span><span class="label">Priority</span></div>
                    </div>
                    <div class="service-links">
                        <a href="/service-nhits-train.html" target="_blank">Info</a>
                        <a href="/nhits-train/docs" target="_blank" class="training-link">API Docs</a>
                    </div>
                </div>

                <!-- TCN-Training Service -->
                <div class="service-card training-card" id="tcn-train-card">
                    <div class="service-header">
                        <h2>TCN-Training</h2>
                        <span class="status-badge status-loading" id="tcn-train-status">Laden...</span>
                    </div>
                    <p>Dedizierter Training-Container - Modell-Training ohne API-Blockierung. Low Priority.</p>
                    <div class="service-info" id="tcn-train-info">
                        <div><span class="label">Port</span><span>3013</span></div>
                        <div><span class="label">Training</span><span id="tcn-train-active">-</span></div>
                        <div><span class="label">Epoch</span><span id="tcn-train-epoch">-</span></div>
                    </div>
                    <div class="service-resources">
                        <div class="service-resource cpu"><span class="value">4 CPU</span><span class="label">CPU Limit</span></div>
                        <div class="service-resource ram"><span class="value">8 GB</span><span class="label">RAM Limit</span></div>
                        <div class="service-resource net"><span class="value">LOW</span><span class="label">Priority</span></div>
                    </div>
                    <div class="service-links">
                        <a href="/service-tcn-train.html" target="_blank">Info</a>
                        <a href="/tcn-train/docs" target="_blank" class="training-link">API Docs</a>
                    </div>
                </div>

                <!-- CNN-LSTM Training Service -->
                <div class="service-card training-card" id="cnn-lstm-train-card">
                    <div class="service-header">
                        <h2>CNN-LSTM-Training</h2>
                        <span class="status-badge status-loading" id="cnn-lstm-train-status">Laden...</span>
                    </div>
                    <p>Dedizierter Training-Container - Multi-Task CNN-LSTM Modelle. Low Priority.</p>
                    <div class="service-info" id="cnn-lstm-train-info">
                        <div><span class="label">Port</span><span>3017</span></div>
                        <div><span class="label">Training</span><span id="cnn-lstm-train-active">-</span></div>
                        <div><span class="label">Epoch</span><span id="cnn-lstm-train-epoch">-</span></div>
                    </div>
                    <div class="service-resources">
                        <div class="service-resource cpu"><span class="value">4 CPU</span><span class="label">CPU Limit</span></div>
                        <div class="service-resource ram"><span class="value">12 GB</span><span class="label">RAM Limit</span></div>
                        <div class="service-resource net"><span class="value">LOW</span><span class="label">Priority</span></div>
                    </div>
                    <div class="service-links">
                        <a href="/service-cnn-lstm.html" target="_blank">Info</a>
                        <a href="/cnn-lstm-train/docs" target="_blank" class="training-link">API Docs</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Supporting Services Section -->
        <div class="training-section">
            <h3 class="section-title"><span class="section-icon">&#128736;</span> Supporting Services</h3>
            <div class="services-grid training-grid">
                <!-- Redis Cache -->
                <div class="service-card" id="redis-card">
                    <div class="service-header">
                        <h2>Redis Cache</h2>
                        <span class="status-badge status-loading" id="redis-status">Laden...</span>
                    </div>
                    <p>Zentraler In-Memory Cache fr alle Services. LRU-Eviction, Persistenz und schnelle Datenzugriffe.</p>
                    <div class="service-info" id="redis-info">
                        <div><span class="label">Port</span><span>6379</span></div>
                        <div><span class="label">Memory</span><span id="redis-memory">512 MB</span></div>
                        <div><span class="label">Policy</span><span id="redis-policy">allkeys-lru</span></div>
                    </div>
                    <div class="service-resources">
                        <div class="service-resource cpu"><span class="value">1 CPU</span><span class="label">CPU Limit</span></div>
                        <div class="service-resource ram"><span class="value">512 MB</span><span class="label">RAM Limit</span></div>
                        <div class="service-resource net"><span class="value">TCP</span><span class="label">Mode</span></div>
                    </div>
                    <div class="service-links">
                        <a href="/service-redis.html" target="_blank">Info</a>
                        <a href="https://redis.io/docs/" target="_blank">Redis Docs</a>
                    </div>
                </div>

                <!-- Watchdog Service -->
                <div class="service-card" id="watchdog-card">
                    <div class="service-header">
                        <h2>Watchdog</h2>
                        <span class="status-badge status-loading" id="watchdog-status">Laden...</span>
                    </div>
                    <p>Service-Monitoring mit Telegram-Alerts - berwacht alle Microservices und sendet Alarme.</p>
                    <div class="service-info" id="watchdog-info">
                        <div><span class="label">Port</span><span>3010</span></div>
                        <div><span class="label">Services</span><span id="watchdog-services">-</span></div>
                        <div><span class="label">Telegram</span><span id="watchdog-telegram">-</span></div>
                    </div>
                    <div class="service-resources">
                        <div class="service-resource cpu"><span class="value">1 CPU</span><span class="label">CPU Limit</span></div>
                        <div class="service-resource ram"><span class="value">512 MB</span><span class="label">RAM Limit</span></div>
                        <div class="service-resource net"><span class="value">CPU</span><span class="label">Mode</span></div>
                    </div>
                    <div class="service-links">
                        <a href="/service-watchdog.html" target="_blank">Info</a>
                        <a href="/watchdog/docs" target="_blank">API Docs</a>
                        <a href="/config-watchdog.html" target="_blank">Config</a>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <footer>
        KI Trading Model v2.0.0 | Microservices Architecture | FastAPI + NHITS + TCN + Candlestick + HMM + Embedder + RAG + LLM + Watchdog
    </footer>

    <!-- Symbols Modal -->
    <div class="modal-overlay" id="symbols-modal" onclick="closeSymbolsModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>EasyInsight Symbole nach Kategorie</h2>
                <button class="modal-close" onclick="closeSymbolsModal()">&times;</button>
            </div>
            <div class="modal-body" id="symbols-modal-content">
                <div class="modal-loading">
                    <div class="spinner"></div>
                    <div>Symbole werden geladen...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const API_BASE = '';  // Relative URLs via nginx proxy

        let healthyServices = 0;
        let totalEndpoints = 0;

        // Mapping service name to dataflow status element id
        const dataflowStatusMap = {
            'data': 'df-data-status',
            'nhits': 'df-nhits-status',
            'tcn': 'df-tcn-status',
            'tcn-train': 'df-tcn-train-status',
            'hmm': 'df-hmm-status',
            'embedder': 'df-embedder-status',
            'candlestick': 'df-candlestick-status',
            'candlestick-train': 'df-candlestick-train-status',
            'nhits-train': 'df-nhits-train-status',
            'hmm-train': 'df-hmm-train-status',
            'cnn-lstm': 'df-cnn-lstm-status',
            'cnn-lstm-train': 'df-cnn-lstm-train-status',
            'rag': 'df-rag-status',
            'llm': 'df-llm-status',
            'watchdog': 'df-watchdog-status',
            // External data sources
            'easyinsight': 'df-easyinsight-status',
            'twelvedata': 'df-twelvedata-status',
            'yahoo': 'df-yahoo-status'
        };

        function updateDataflowStatus(service, isHealthy) {
            const dfStatusId = dataflowStatusMap[service];
            if (dfStatusId) {
                const dfStatusEl = document.getElementById(dfStatusId);
                if (dfStatusEl) {
                    dfStatusEl.classList.remove('loading', 'healthy', 'unhealthy');
                    dfStatusEl.classList.add(isHealthy ? 'healthy' : 'unhealthy');
                }
            }
            // Update corresponding Watchdog Panel dot
            updateWatchdogPanelDot(service, isHealthy);
        }

        function updateWatchdogPanelDot(service, isHealthy) {
            const dotMapping = {
                'data': 'wp-dot-data',
                'nhits': 'wp-dot-nhits',
                'tcn': 'wp-dot-tcn',
                'hmm': 'wp-dot-hmm',
                'embedder': 'wp-dot-embedder',
                'candlestick': 'wp-dot-candlestick',
                'cnn-lstm': 'wp-dot-cnn-lstm',
                'rag': 'wp-dot-rag',
                'llm': 'wp-dot-llm'
            };
            const dotId = dotMapping[service];
            if (dotId) {
                const dotEl = document.getElementById(dotId);
                if (dotEl) {
                    dotEl.classList.remove('loading', 'healthy', 'unhealthy');
                    dotEl.classList.add(isHealthy ? 'healthy' : 'unhealthy');
                }
            }
        }

        // Fetch with timeout helper
        async function fetchWithTimeout(url, timeoutMs = 5000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeoutMs);
            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);
                return response;
            } catch (err) {
                clearTimeout(timeoutId);
                throw err;
            }
        }

        // Cached watchdog status for all services
        let watchdogServicesStatus = {};

        // Central function to fetch all service status from Watchdog
        async function fetchWatchdogStatus() {
            try {
                const res = await fetchWithTimeout('/watchdog/api/v1/status', 5000);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();
                watchdogServicesStatus = data.services || {};
                return data;
            } catch (err) {
                console.error('Failed to fetch watchdog status:', err);
                watchdogServicesStatus = {};
                return null;
            }
        }

        // Update service status from cached watchdog data
        function updateServiceFromWatchdog(service, statusId) {
            const serviceData = watchdogServicesStatus[service];
            const statusEl = document.getElementById(statusId);

            if (!statusEl) return null;

            if (serviceData) {
                const isHealthy = serviceData.state === 'HEALTHY';
                const isDegraded = serviceData.state === 'DEGRADED';

                if (isHealthy) {
                    statusEl.textContent = 'Online';
                    statusEl.className = 'status-badge status-healthy';
                    healthyServices++;
                } else if (isDegraded) {
                    statusEl.textContent = 'Degraded';
                    statusEl.className = 'status-badge status-unhealthy';
                } else {
                    statusEl.textContent = 'Offline';
                    statusEl.className = 'status-badge status-unhealthy';
                }

                // Update dataflow status indicator
                updateDataflowStatus(service, isHealthy);

                return { status: isHealthy ? 'healthy' : 'unhealthy', ...serviceData };
            } else {
                statusEl.textContent = 'Unbekannt';
                statusEl.className = 'status-badge status-unhealthy';
                updateDataflowStatus(service, false);
                return null;
            }
        }

        // Legacy checkHealth for services that need additional data from their own endpoints
        async function checkHealth(service, port, statusId) {
            // First update status from watchdog cache
            // Skip for watchdog itself - it doesn't monitor itself
            if (service !== 'watchdog') {
                updateServiceFromWatchdog(service, statusId);
            }

            // Then fetch additional details from service endpoint
            try {
                const res = await fetchWithTimeout(`/${service}/health`, 3000);
                if (!res.ok) return null;
                return await res.json();
            } catch (err) {
                return null;
            }
        }

        async function updateNhitsInfo() {
            const data = await checkHealth('nhits', 3002, 'nhits-status');
            if (data) {
                document.getElementById('nhits-training').textContent = data.training_in_progress ? 'Aktiv' : 'Inaktiv';
            }
        }

        async function updateLlmInfo() {
            const data = await checkHealth('llm', 3009, 'llm-status');
            if (data) {
                document.getElementById('llm-model').textContent = data.llm_model || '-';
                document.getElementById('llm-rag').textContent = data.rag_enabled ? 'Aktiviert' : 'Deaktiviert';
            }
        }

        async function updateDataInfo() {
            const data = await checkHealth('data', 3001, 'data-status');
            if (data) {
                document.getElementById('data-easyinsight').textContent = data.easyinsight_api ? 'Verbunden' : '-';
                document.getElementById('data-sync').textContent = data.sync_service_status || '-';
            }
        }

        // Update Redis status from cached watchdog data
        function updateRedisStatus() {
            const redisDot = document.getElementById('wp-dot-redis');
            const redisStatus = document.getElementById('redis-status');
            const redisDataflow = document.getElementById('df-redis-status');

            const redisService = watchdogServicesStatus['redis'];
            const redisHealthy = redisService?.state === 'HEALTHY';

            if (redisDot) {
                redisDot.classList.remove('loading', 'healthy', 'unhealthy');
                redisDot.classList.add(redisHealthy ? 'healthy' : 'unhealthy');
            }

            if (redisStatus) {
                redisStatus.classList.remove('status-loading', 'status-healthy', 'status-unhealthy');
                redisStatus.classList.add(redisHealthy ? 'status-healthy' : 'status-unhealthy');
                redisStatus.textContent = redisHealthy ? 'Online' : 'Offline';
            }

            if (redisDataflow) {
                redisDataflow.classList.remove('loading', 'healthy', 'unhealthy');
                redisDataflow.classList.add(redisHealthy ? 'healthy' : 'unhealthy');
            }
        }

        // Update EasyInsight status from cached watchdog data
        function updateEasyInsightStatusFromWatchdog() {
            const easyinsightService = watchdogServicesStatus['easyinsight'];
            const statusEl = document.getElementById('easyinsight-status');

            if (easyinsightService) {
                const isHealthy = easyinsightService.state === 'HEALTHY';
                if (statusEl) {
                    statusEl.textContent = isHealthy ? 'Online' : 'Offline';
                    statusEl.className = `status-badge ${isHealthy ? 'status-healthy' : 'status-unhealthy'}`;
                    if (isHealthy) healthyServices++;
                }
                // Update dataflow status
                updateDataflowStatus('easyinsight', isHealthy);
            } else {
                // No data from watchdog - mark as unknown/loading
                updateDataflowStatus('easyinsight', false);
            }
        }

        // Update TwelveData status from cached watchdog data
        function updateTwelveDataStatusFromWatchdog() {
            const twelvedataService = watchdogServicesStatus['twelvedata'];

            if (twelvedataService) {
                const isHealthy = twelvedataService.state === 'HEALTHY';
                const isDegraded = twelvedataService.state === 'DEGRADED';
                // DEGRADED means API key not configured but service is reachable
                updateDataflowStatus('twelvedata', isHealthy || isDegraded);
            } else {
                updateDataflowStatus('twelvedata', false);
            }
        }

        // Update Yahoo Finance status from cached watchdog data
        function updateYahooStatusFromWatchdog() {
            const yahooService = watchdogServicesStatus['yahoo'];

            if (yahooService) {
                const isHealthy = yahooService.state === 'HEALTHY';
                updateDataflowStatus('yahoo', isHealthy);
            } else {
                updateDataflowStatus('yahoo', false);
            }
        }

        async function updateRagInfo() {
            const data = await checkHealth('rag', 3008, 'rag-status');
            if (data) {
                document.getElementById('rag-docs').textContent = data.document_count || 0;
            }
        }

        async function updateTcnInfo() {
            const data = await checkHealth('tcn', 3003, 'tcn-status');
            if (data) {
                // Try to get model info with timeout
                try {
                    const modelRes = await fetchWithTimeout('/tcn/api/v1/model', 5000);
                    if (modelRes.ok) {
                        const modelData = await modelRes.json();
                        document.getElementById('tcn-model-status').textContent = modelData.loaded ? 'Geladen' : 'Nicht geladen';
                    }
                } catch (e) {
                    document.getElementById('tcn-model-status').textContent = e.name === 'AbortError' ? 'Timeout' : '-';
                }
            }
        }

        async function updateTcnTrainInfo() {
            const data = await checkHealth('tcn-train', 3013, 'tcn-train-status');
            if (data) {
                const activeEl = document.getElementById('tcn-train-active');
                const epochEl = document.getElementById('tcn-train-epoch');

                // Get detailed training status with timeout
                try {
                    const statusRes = await fetchWithTimeout('/tcn-train/api/v1/train/status', 5000);
                    if (statusRes.ok) {
                        const statusData = await statusRes.json();

                        if (statusData.status === 'training') {
                            activeEl.textContent = 'Training...';
                            activeEl.style.color = '#ffd54f';
                            if (statusData.current_epoch) {
                                const progress = Math.round((statusData.current_epoch / statusData.total_epochs) * 100);
                                epochEl.textContent = `${statusData.current_epoch}/${statusData.total_epochs} (${progress}%)`;
                            } else {
                                epochEl.textContent = 'Vorbereitung...';
                            }
                        } else if (statusData.status === 'preparing') {
                            activeEl.textContent = 'Vorbereitung';
                            activeEl.style.color = '#ffd54f';
                            epochEl.textContent = 'Daten laden...';
                        } else {
                            activeEl.textContent = 'Inaktiv';
                            activeEl.style.color = '';
                            epochEl.textContent = '-';
                        }
                    }
                } catch (e) {
                    // Fallback to health check data
                    activeEl.textContent = data.training_active ? 'Aktiv' : 'Inaktiv';
                    epochEl.textContent = e.name === 'AbortError' ? 'Timeout' : '-';
                }
            }
        }

        async function updateHmmInfo() {
            const data = await checkHealth('hmm', 3004, 'hmm-status');
            if (data) {
                document.getElementById('hmm-scorer').textContent = data.lightgbm_available ? 'Bereit' : '-';
            }
        }

        async function updateEmbedderInfo() {
            await checkHealth('embedder', 3005, 'embedder-status');
        }

        async function updateCandlestickInfo() {
            const data = await checkHealth('candlestick', 3006, 'candlestick-status');
            if (data) {
                const autoscanEl = document.getElementById('candlestick-autoscan');
                autoscanEl.textContent = data.auto_scan_enabled ? 'Aktiv' : 'Inaktiv';
            }
        }

        async function updateCandlestickTrainInfo() {
            const data = await checkHealth('candlestick-train', 3016, 'candlestick-train-status');
            if (data) {
                const activeEl = document.getElementById('candlestick-train-active');
                const jobsEl = document.getElementById('candlestick-train-jobs');

                // Get detailed training status with timeout
                try {
                    const statusRes = await fetchWithTimeout('/candlestick-train/api/v1/train/status', 5000);
                    if (statusRes.ok) {
                        const statusData = await statusRes.json();

                        if (statusData.status === 'training') {
                            activeEl.textContent = 'Training...';
                            activeEl.style.color = '#ffd54f';
                        } else if (statusData.status === 'preparing') {
                            activeEl.textContent = 'Vorbereitung';
                            activeEl.style.color = '#ffd54f';
                        } else {
                            activeEl.textContent = 'Inaktiv';
                            activeEl.style.color = '';
                        }
                    }
                } catch (e) {
                    activeEl.textContent = data.training_active ? 'Aktiv' : 'Inaktiv';
                }

                // Get jobs count
                try {
                    const jobsRes = await fetchWithTimeout('/candlestick-train/api/v1/train/jobs', 5000);
                    if (jobsRes.ok) {
                        const jobsData = await jobsRes.json();
                        jobsEl.textContent = jobsData.length || 0;
                    }
                } catch (e) {
                    jobsEl.textContent = '-';
                }
            }
        }

        async function updateNhitsTrainInfo() {
            const data = await checkHealth('nhits-train', 3012, 'nhits-train-status');
            if (data) {
                const activeEl = document.getElementById('nhits-train-active');
                const jobsEl = document.getElementById('nhits-train-jobs');

                // Get detailed training status with timeout
                try {
                    const statusRes = await fetchWithTimeout('/nhits-train/api/v1/train/status', 5000);
                    if (statusRes.ok) {
                        const statusData = await statusRes.json();

                        if (statusData.status === 'training') {
                            activeEl.textContent = 'Training...';
                            activeEl.style.color = '#ffd54f';
                        } else if (statusData.status === 'preparing') {
                            activeEl.textContent = 'Vorbereitung';
                            activeEl.style.color = '#ffd54f';
                        } else {
                            activeEl.textContent = 'Inaktiv';
                            activeEl.style.color = '';
                        }
                    }
                } catch (e) {
                    activeEl.textContent = data.training_in_progress ? 'Aktiv' : 'Inaktiv';
                }

                // Get jobs count
                try {
                    const jobsRes = await fetchWithTimeout('/nhits-train/api/v1/train/jobs', 5000);
                    if (jobsRes.ok) {
                        const jobsData = await jobsRes.json();
                        jobsEl.textContent = jobsData.jobs ? jobsData.jobs.length : 0;
                    }
                } catch (e) {
                    jobsEl.textContent = '-';
                }
            }
        }

        async function updateHmmTrainInfo() {
            const data = await checkHealth('hmm-train', 3014, 'hmm-train-status');
            if (data) {
                const activeEl = document.getElementById('hmm-train-active');
                const modelEl = document.getElementById('hmm-train-model');

                // Get detailed training status with timeout
                try {
                    const statusRes = await fetchWithTimeout('/hmm-train/api/v1/train/status', 5000);
                    if (statusRes.ok) {
                        const statusData = await statusRes.json();

                        if (statusData.status === 'training') {
                            activeEl.textContent = 'Training...';
                            activeEl.style.color = '#ffd54f';
                            modelEl.textContent = statusData.model_type || 'HMM';
                        } else if (statusData.status === 'preparing') {
                            activeEl.textContent = 'Vorbereitung';
                            activeEl.style.color = '#ffd54f';
                            modelEl.textContent = '-';
                        } else {
                            activeEl.textContent = 'Inaktiv';
                            activeEl.style.color = '';
                            modelEl.textContent = '-';
                        }
                    }
                } catch (e) {
                    activeEl.textContent = data.training_in_progress ? 'Aktiv' : 'Inaktiv';
                    modelEl.textContent = '-';
                }
            }
        }

        async function updateCnnLstmInfo() {
            const data = await checkHealth('cnn-lstm', 3007, 'cnn-lstm-status');
            if (data) {
                const modelEl = document.getElementById('cnn-lstm-model-status');
                if (data.model_loaded) {
                    modelEl.textContent = 'Geladen';
                    modelEl.style.color = '#81c784';
                } else {
                    modelEl.textContent = 'Nicht geladen';
                    modelEl.style.color = '#ffd54f';
                }
            }
        }

        async function updateCnnLstmTrainInfo() {
            const data = await checkHealth('cnn-lstm-train', 3017, 'cnn-lstm-train-status');
            if (data) {
                const activeEl = document.getElementById('cnn-lstm-train-active');
                const epochEl = document.getElementById('cnn-lstm-train-epoch');

                // Get detailed training status with timeout
                try {
                    const statusRes = await fetchWithTimeout('/cnn-lstm-train/api/v1/train/status', 5000);
                    if (statusRes.ok) {
                        const statusData = await statusRes.json();

                        if (statusData.status === 'training') {
                            activeEl.textContent = 'Training...';
                            activeEl.style.color = '#ffd54f';
                            if (statusData.current_epoch) {
                                const progress = Math.round((statusData.current_epoch / statusData.total_epochs) * 100);
                                epochEl.textContent = `${statusData.current_epoch}/${statusData.total_epochs} (${progress}%)`;
                            } else {
                                epochEl.textContent = 'Vorbereitung...';
                            }
                        } else if (statusData.status === 'preparing') {
                            activeEl.textContent = 'Vorbereitung';
                            activeEl.style.color = '#ffd54f';
                            epochEl.textContent = 'Daten laden...';
                        } else {
                            activeEl.textContent = 'Inaktiv';
                            activeEl.style.color = '';
                            epochEl.textContent = '-';
                        }
                    }
                } catch (e) {
                    activeEl.textContent = data.training_in_progress ? 'Aktiv' : 'Inaktiv';
                    epochEl.textContent = e.name === 'AbortError' ? 'Timeout' : '-';
                }
            }
        }

        async function updateWatchdogInfo() {
            const data = await checkHealth('watchdog', 3010, 'watchdog-status');
            const statusEl = document.getElementById('watchdog-status');

            if (data) {
                // Watchdog is online - update status badge and dataflow status explicitly
                // (Watchdog doesn't monitor itself, so we need to set this manually)
                const isHealthy = data.status === 'healthy';

                if (statusEl) {
                    statusEl.textContent = isHealthy ? 'Online' : 'Unhealthy';
                    statusEl.className = isHealthy ? 'status-badge status-healthy' : 'status-badge status-unhealthy';
                    if (isHealthy) healthyServices++;
                }

                updateDataflowStatus('watchdog', isHealthy);

                // Count healthy/total services from watchdog status
                const servicesEl = document.getElementById('watchdog-services');
                const telegramEl = document.getElementById('watchdog-telegram');

                if (data.services_monitored !== undefined) {
                    servicesEl.textContent = `${data.healthy_count || 0}/${data.services_monitored}`;
                } else {
                    servicesEl.textContent = '-';
                }

                telegramEl.textContent = data.telegram_enabled ? 'Aktiv' : 'Inaktiv';

                // Update Watchdog Panel (neben Datenfluss)
                updateWatchdogPanel(data);
            } else {
                // Watchdog offline - update status badge and panel
                if (statusEl) {
                    statusEl.textContent = 'Offline';
                    statusEl.className = 'status-badge status-unhealthy';
                }
                updateWatchdogPanelOffline();
                updateDataflowStatus('watchdog', false);
            }
        }

        function updateWatchdogPanel(data) {
            // Status Badge
            const statusBadge = document.getElementById('wp-watchdog-status');
            if (statusBadge) {
                statusBadge.textContent = 'Online';
                statusBadge.classList.remove('loading', 'unhealthy');
                statusBadge.classList.add('healthy');
            }

            // Services Online
            const servicesOnline = document.getElementById('wp-services-online');
            if (servicesOnline && data.services_monitored !== undefined) {
                const healthy = data.healthy_count || 0;
                const total = data.services_monitored;
                servicesOnline.textContent = `${healthy}/${total}`;
                servicesOnline.classList.remove('healthy', 'warning', 'error');
                if (healthy === total) {
                    servicesOnline.classList.add('healthy');
                } else if (healthy >= total / 2) {
                    servicesOnline.classList.add('warning');
                } else {
                    servicesOnline.classList.add('error');
                }
            }

            // Telegram Status
            const telegramStatus = document.getElementById('wp-telegram-status');
            if (telegramStatus) {
                telegramStatus.textContent = data.telegram_enabled ? 'Aktiv' : 'Inaktiv';
                telegramStatus.classList.remove('healthy', 'warning');
                telegramStatus.classList.add(data.telegram_enabled ? 'healthy' : 'warning');
            }

            // Last Check
            const lastCheck = document.getElementById('wp-last-check');
            if (lastCheck) {
                const now = new Date();
                lastCheck.textContent = now.toLocaleTimeString('de-CH');
            }
        }

        function updateWatchdogPanelOffline() {
            const statusBadge = document.getElementById('wp-watchdog-status');
            if (statusBadge) {
                statusBadge.textContent = 'Offline';
                statusBadge.classList.remove('loading', 'healthy');
                statusBadge.classList.add('unhealthy');
            }

            const servicesOnline = document.getElementById('wp-services-online');
            if (servicesOnline) {
                servicesOnline.textContent = '-';
                servicesOnline.classList.remove('healthy', 'warning');
                servicesOnline.classList.add('error');
            }
        }

        // Update Watchdog Panel mini service dots based on dataflow status
        function updateWatchdogPanelDots() {
            const dotMapping = {
                'data': 'wp-dot-data',
                'nhits': 'wp-dot-nhits',
                'tcn': 'wp-dot-tcn',
                'hmm': 'wp-dot-hmm',
                'embedder': 'wp-dot-embedder',
                'candlestick': 'wp-dot-candlestick',
                'cnn-lstm': 'wp-dot-cnn-lstm',
                'rag': 'wp-dot-rag',
                'llm': 'wp-dot-llm'
            };

            for (const [service, dotId] of Object.entries(dotMapping)) {
                const dfStatusId = dataflowStatusMap[service];
                if (dfStatusId) {
                    const dfStatusEl = document.getElementById(dfStatusId);
                    const dotEl = document.getElementById(dotId);
                    if (dfStatusEl && dotEl) {
                        dotEl.classList.remove('loading', 'healthy', 'unhealthy');
                        if (dfStatusEl.classList.contains('healthy')) {
                            dotEl.classList.add('healthy');
                        } else if (dfStatusEl.classList.contains('unhealthy')) {
                            dotEl.classList.add('unhealthy');
                        } else {
                            dotEl.classList.add('loading');
                        }
                    }
                }
            }
        }

        // Sync Watchdog panel dots directly from cached Watchdog status
        // This ensures dots reflect Watchdog's authoritative status, not individual service timeouts
        function syncWatchdogPanelDotsFromCache() {
            const services = ['data', 'nhits', 'tcn', 'hmm', 'embedder', 'candlestick', 'rag', 'llm'];
            const dotMapping = {
                'data': 'wp-dot-data',
                'nhits': 'wp-dot-nhits',
                'tcn': 'wp-dot-tcn',
                'hmm': 'wp-dot-hmm',
                'embedder': 'wp-dot-embedder',
                'candlestick': 'wp-dot-candlestick',
                'cnn-lstm': 'wp-dot-cnn-lstm',
                'rag': 'wp-dot-rag',
                'llm': 'wp-dot-llm'
            };

            for (const service of services) {
                const dotId = dotMapping[service];
                const dotEl = document.getElementById(dotId);
                const serviceData = watchdogServicesStatus[service];

                if (dotEl) {
                    dotEl.classList.remove('loading', 'healthy', 'unhealthy');
                    if (serviceData && serviceData.state === 'HEALTHY') {
                        dotEl.classList.add('healthy');
                    } else if (serviceData && serviceData.state === 'DEGRADED') {
                        dotEl.classList.add('unhealthy');
                    } else if (serviceData) {
                        dotEl.classList.add('unhealthy');
                    } else {
                        dotEl.classList.add('loading');
                    }
                }
            }
        }

        async function updateEasyInsightInfo() {
            // Status already set by updateEasyInsightStatusFromWatchdog()
            // This function only fetches additional details (symbols count, latency)
            const symbolsEl = document.getElementById('easyinsight-symbols');
            const latencyEl = document.getElementById('easyinsight-latency');

            // Only fetch details if EasyInsight is healthy according to watchdog
            const easyinsightService = watchdogServicesStatus['easyinsight'];
            if (easyinsightService?.state !== 'HEALTHY') {
                symbolsEl.textContent = '-';
                latencyEl.textContent = '-';
                return;
            }

            try {
                const startTime = performance.now();
                const res = await fetch('/easyinsight/api/symbols');
                const latency = Math.round(performance.now() - startTime);

                if (res.ok) {
                    const symbols = await res.json();
                    symbolsEl.textContent = symbols.length;
                    latencyEl.textContent = `${latency}ms`;
                } else {
                    throw new Error('API returned error');
                }
            } catch (err) {
                symbolsEl.textContent = '-';
                latencyEl.textContent = '-';
            }
        }

        async function updateSystemMetrics() {
            try {
                const res = await fetch('/nhits/api/v1/system/metrics');
                if (!res.ok) throw new Error('Metrics fetch failed');
                const data = await res.json();

                // Helper function to determine bar color class based on percentage
                function getColorClass(percent) {
                    if (percent >= 90) return 'high';
                    if (percent >= 70) return 'medium';
                    return '';
                }

                // Helper function for temperature color class
                function getTempClass(temp) {
                    if (temp >= 70) return 'hot';
                    if (temp >= 50) return 'warm';
                    return 'cool';
                }

                // CPU metrics
                if (data.cpu) {
                    const cpuPercent = Math.round(data.cpu.percent || 0);
                    const cpuBar = document.getElementById('cpu-bar');
                    cpuBar.style.width = `${Math.max(cpuPercent, 5)}%`;
                    cpuBar.className = `metric-bar cpu ${getColorClass(cpuPercent)}`;
                    document.getElementById('cpu-percent').textContent = `${cpuPercent}%`;
                    document.getElementById('cpu-cores').textContent = `${data.cpu.cores_logical || '-'}`;

                    // CPU Temperature
                    const cpuTempEl = document.getElementById('cpu-temp');
                    if (data.cpu.temp_celsius) {
                        const temp = Math.round(data.cpu.temp_celsius);
                        cpuTempEl.textContent = `${temp}C`;
                        cpuTempEl.className = `value temp-indicator ${getTempClass(temp)}`;
                    } else {
                        cpuTempEl.textContent = '-';
                    }
                }

                // Memory metrics
                if (data.memory) {
                    const memPercent = Math.round(data.memory.percent || 0);
                    const memBar = document.getElementById('memory-bar');
                    memBar.style.width = `${Math.max(memPercent, 5)}%`;
                    memBar.className = `metric-bar memory ${getColorClass(memPercent)}`;
                    document.getElementById('memory-percent').textContent = `${memPercent}%`;
                    document.getElementById('memory-total').textContent = `${data.memory.total_gb} GB`;
                    document.getElementById('memory-used').textContent = `${data.memory.used_gb} GB`;
                }

                // GPU metrics
                const gpuContent = document.getElementById('gpu-content');
                const gpuUnavailable = document.getElementById('gpu-unavailable');

                if (data.gpu && data.gpu.available) {
                    gpuContent.style.display = 'block';
                    gpuUnavailable.style.display = 'none';

                    // GPU utilization bar
                    const gpuUtilPercent = Math.round(data.gpu.utilization_percent || 0);
                    const gpuUtilBar = document.getElementById('gpu-util-bar');
                    gpuUtilBar.style.width = `${Math.max(gpuUtilPercent, 5)}%`;
                    gpuUtilBar.className = `metric-bar gpu ${getColorClass(gpuUtilPercent)}`;
                    document.getElementById('gpu-util-percent').textContent = `${gpuUtilPercent}%`;

                    // GPU Temperature
                    const gpuTempEl = document.getElementById('gpu-temp');
                    if (data.gpu.temp_celsius) {
                        const temp = Math.round(data.gpu.temp_celsius);
                        gpuTempEl.textContent = `${temp}C`;
                        gpuTempEl.className = `value temp-indicator ${getTempClass(temp)}`;
                    } else {
                        gpuTempEl.textContent = '-';
                    }

                    // GPU VRAM (nur genutzt, Total ist bei Shared VRAM)
                    document.getElementById('gpu-vram').textContent =
                        `${data.gpu.memory_allocated_gb} GB`;
                } else {
                    gpuContent.style.display = 'none';
                    gpuUnavailable.style.display = 'block';
                }

                // Total Power (from power object)
                if (data.power && data.power.available) {
                    const totalPowerEl = document.getElementById('total-power');
                    const gpuPowerEl = document.getElementById('gpu-power');
                    const powerBar = document.getElementById('power-bar');
                    const powerPercentEl = document.getElementById('power-percent');

                    if (data.power.total_watts) {
                        totalPowerEl.textContent = `${data.power.total_watts} W`;
                        // Assume max power of 100W for Jetson AGX Thor, calculate percentage
                        const maxPower = 100;
                        const powerPercent = Math.min(Math.round((data.power.total_watts / maxPower) * 100), 100);
                        powerBar.style.width = `${Math.max(powerPercent, 5)}%`;
                        powerPercentEl.textContent = `${powerPercent}%`;
                        // Color based on power consumption
                        if (powerPercent >= 80) {
                            powerBar.className = 'metric-bar power high';
                        } else if (powerPercent >= 60) {
                            powerBar.className = 'metric-bar power medium';
                        } else {
                            powerBar.className = 'metric-bar power';
                        }
                    } else {
                        totalPowerEl.textContent = '-';
                        powerBar.style.width = '0%';
                        powerPercentEl.textContent = '-';
                    }

                    if (data.power.gpu_watts) {
                        gpuPowerEl.textContent = `${data.power.gpu_watts} W`;
                    } else {
                        gpuPowerEl.textContent = '-';
                    }
                }

            } catch (err) {
                console.error('System metrics error:', err);
            }
        }

        async function updateStorageMetrics() {
            try {
                const res = await fetch('/nhits/api/v1/system/storage');
                if (!res.ok) throw new Error('Storage metrics fetch failed');
                const data = await res.json();

                // Helper function to determine bar color class based on percentage
                function getColorClass(percent) {
                    if (percent >= 90) return 'high';
                    if (percent >= 70) return 'medium';
                    return '';
                }

                // Disk metrics
                if (data.disk) {
                    const diskPercent = Math.round(data.disk.percent || 0);
                    const diskBar = document.getElementById('disk-bar');
                    diskBar.style.width = `${Math.max(diskPercent, 5)}%`;
                    diskBar.className = `metric-bar disk ${getColorClass(diskPercent)}`;
                    document.getElementById('disk-percent').textContent = `${diskPercent}%`;
                    document.getElementById('disk-total').textContent = `${data.disk.total_gb} GB`;
                    document.getElementById('disk-free').textContent = `${data.disk.free_gb} GB`;
                }

                // Volumes list
                const volumeList = document.getElementById('volume-list');
                if (data.app_storage && data.app_storage.volumes && data.app_storage.volumes.length > 0) {
                    volumeList.innerHTML = data.app_storage.volumes.map(volume => `
                        <div class="volume-item">
                            <div>
                                <div class="volume-name">${volume.name}</div>
                                <div class="container-size">${volume.path}</div>
                            </div>
                            <div class="volume-driver">${volume.size}</div>
                        </div>
                    `).join('');
                } else {
                    volumeList.innerHTML = '<div class="storage-loading">Keine Volume-Daten</div>';
                }

            } catch (err) {
                console.error('Storage metrics error:', err);
                document.getElementById('volume-list').innerHTML = '<div class="storage-loading">Fehler beim Laden</div>';
            }
        }

        async function refreshStatus() {
            healthyServices = 0;

            // First fetch all service status from Watchdog (single API call)
            await fetchWatchdogStatus();

            // Then update UI and fetch additional details where needed
            // Redis and external sources only need watchdog data (no additional details)
            updateRedisStatus();
            updateEasyInsightStatusFromWatchdog();
            updateTwelveDataStatusFromWatchdog();
            updateYahooStatusFromWatchdog();

            await Promise.all([
                updateNhitsInfo(),
                updateLlmInfo(),
                updateDataInfo(),
                updateRagInfo(),
                updateTcnInfo(),
                updateTcnTrainInfo(),
                updateHmmInfo(),
                updateEmbedderInfo(),
                updateCandlestickInfo(),
                updateCandlestickTrainInfo(),
                updateNhitsTrainInfo(),
                updateHmmTrainInfo(),
                updateCnnLstmInfo(),
                updateCnnLstmTrainInfo(),
                updateWatchdogInfo(),
                updateEasyInsightInfo(),  // Fetch additional details (symbols, latency)
                updateSystemMetrics(),
                updateStorageMetrics()
            ]);

            // Final sync: Ensure Watchdog panel dots match cached Watchdog status
            // This corrects any inconsistencies from parallel updates or timeouts
            syncWatchdogPanelDotsFromCache();

            document.getElementById('last-update').textContent = `Update: ${new Date().toLocaleTimeString('de-DE')}`;
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Symbol Modal Functions
        let cachedSymbols = null;

        // Category info mapping - uses EasyInsight API categories as master
        const categoryInfo = {
            'Forex': { icon: '\u{1F4B1}', name: 'Forex', order: 1 },
            'Crypto': { icon: '\u{1FA99}', name: 'Krypto', order: 2 },
            'Indices': { icon: '\u{1F4CA}', name: 'Indizes', order: 3 },
            'Metals': { icon: '\u{1F947}', name: 'Metalle', order: 4 },
            'Extra': { icon: '\u{2B50}', name: 'Extra', order: 5 },
            'Other': { icon: '\u{2753}', name: 'Sonstige', order: 99 }
        };

        function groupSymbolsByCategory(symbols) {
            const groups = {};

            symbols.forEach(symbolData => {
                // Use category from API directly
                const symbol = symbolData.symbol || symbolData;
                const category = symbolData.category || 'Other';

                if (!groups[category]) {
                    groups[category] = [];
                }
                groups[category].push(symbol);
            });

            // Sort symbols within each category
            Object.keys(groups).forEach(cat => {
                groups[cat].sort();
            });

            return groups;
        }

        function renderSymbolsModal(symbols) {
            const groups = groupSymbolsByCategory(symbols);
            const content = document.getElementById('symbols-modal-content');

            // Summary stats
            let html = '<div class="modal-summary">';
            html += `<div class="summary-stat"><div class="value">${symbols.length}</div><div class="label">Gesamt</div></div>`;

            const sortedCategories = Object.keys(groups).sort((a, b) =>
                (categoryInfo[a]?.order || 99) - (categoryInfo[b]?.order || 99)
            );

            sortedCategories.forEach(cat => {
                const info = categoryInfo[cat] || { icon: '\u2753', name: cat };
                html += `<div class="summary-stat"><div class="value">${groups[cat].length}</div><div class="label">${info.icon} ${info.name}</div></div>`;
            });
            html += '</div>';

            // Category groups
            sortedCategories.forEach(cat => {
                const info = categoryInfo[cat] || { icon: '\u2753', name: cat };
                const symbolsList = groups[cat];

                html += `
                    <div class="category-group">
                        <div class="category-header">
                            <span class="category-icon">${info.icon}</span>
                            <span class="category-name">${info.name}</span>
                            <span class="category-count">${symbolsList.length}</span>
                        </div>
                        <div class="symbols-grid">
                            ${symbolsList.map(s => `<span class="symbol-chip">${s}</span>`).join('')}
                        </div>
                    </div>
                `;
            });

            content.innerHTML = html;
        }

        async function openSymbolsModal() {
            const modal = document.getElementById('symbols-modal');
            const content = document.getElementById('symbols-modal-content');

            // Show modal with loading state
            modal.classList.add('show');
            content.innerHTML = '<div class="modal-loading"><div class="spinner"></div><div>Symbole werden geladen...</div></div>';

            try {
                // Use cached symbols if available
                if (cachedSymbols) {
                    renderSymbolsModal(cachedSymbols);
                    return;
                }

                const res = await fetch('/easyinsight/api/symbols');
                if (res.ok) {
                    cachedSymbols = await res.json();
                    renderSymbolsModal(cachedSymbols);
                } else {
                    content.innerHTML = '<div class="modal-loading"><div>Fehler beim Laden der Symbole</div></div>';
                }
            } catch (err) {
                content.innerHTML = '<div class="modal-loading"><div>Verbindungsfehler: ' + err.message + '</div></div>';
            }
        }

        function closeSymbolsModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('symbols-modal').classList.remove('show');
        }

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeSymbolsModal();
            }
        });

        // Initial load
        refreshStatus();

        // Auto-refresh service status every 10 seconds
        setInterval(refreshStatus, 10000);

        // Update system metrics more frequently (every 3 seconds) for smoother monitoring
        setInterval(updateSystemMetrics, 3000);
    </script>
</body>
</html>
