<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KI Trading Model - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
            margin-bottom: 1.5rem;
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .header-status {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
        }

        .header-status span {
            padding: 0.4rem 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 1400px) {
            .services-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 1200px) {
            .services-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .services-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .services-grid {
                grid-template-columns: 1fr;
            }
        }

        .service-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            min-height: 280px;
        }

        .service-card:hover {
            transform: translateY(-3px);
            border-color: rgba(100, 200, 255, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .service-card h2 {
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-healthy {
            background: rgba(76, 175, 80, 0.2);
            color: #81c784;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .status-unhealthy {
            background: rgba(244, 67, 54, 0.2);
            color: #e57373;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .status-loading {
            background: rgba(255, 193, 7, 0.2);
            color: #ffd54f;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .service-card p {
            opacity: 0.8;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .service-info {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 1rem;
            font-size: 0.8rem;
            flex-shrink: 0;
            margin-top: auto;
        }

        .service-info div {
            display: flex;
            justify-content: space-between;
            padding: 0.3rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .service-info div:last-child {
            border-bottom: none;
        }

        .service-info .label {
            opacity: 0.6;
        }

        .service-links {
            display: flex;
            gap: 0.4rem;
            flex-wrap: nowrap;
            flex-shrink: 0;
        }

        .service-links a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.4rem 0.5rem;
            background: rgba(100, 200, 255, 0.1);
            color: #64c8ff;
            border-radius: 5px;
            text-decoration: none;
            font-size: 0.75rem;
            transition: all 0.2s;
            border: 1px solid rgba(100, 200, 255, 0.2);
            white-space: nowrap;
        }

        .service-links a:hover {
            background: rgba(100, 200, 255, 0.2);
            transform: translateY(-1px);
        }

        /* System Metrics Styles */
        .metrics-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 800px) {
            .metrics-section {
                grid-template-columns: 1fr;
            }
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric-card h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metric-icon {
            font-size: 1.2rem;
        }

        .metric-bar-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            height: 24px;
            overflow: hidden;
            margin-bottom: 0.8rem;
            position: relative;
        }

        .metric-bar {
            height: 100%;
            border-radius: 8px;
            transition: width 0.5s ease, background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 40px;
        }

        .metric-bar.cpu {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
        }

        .metric-bar.memory {
            background: linear-gradient(90deg, #8b5cf6, #a78bfa);
        }

        .metric-bar.gpu {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .metric-bar.gpu-memory {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        .metric-bar.high {
            background: linear-gradient(90deg, #ef4444, #f87171) !important;
        }

        .metric-bar.medium {
            background: linear-gradient(90deg, #f59e0b, #fbbf24) !important;
        }

        .metric-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .metric-detail {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0.6rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
        }

        .metric-detail .label {
            opacity: 0.6;
        }

        .metric-detail .value {
            font-weight: 500;
        }

        .gpu-unavailable {
            text-align: center;
            padding: 2rem;
            opacity: 0.5;
            font-size: 0.9rem;
        }

        /* Storage Section Styles */
        .storage-section {
            margin-bottom: 1.5rem;
        }

        .storage-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .storage-card h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .storage-overview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 800px) {
            .storage-overview {
                grid-template-columns: 1fr;
            }
        }

        .storage-disk {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 1rem;
        }

        .storage-disk h4 {
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metric-bar.disk {
            background: linear-gradient(90deg, #06b6d4, #22d3ee);
        }

        .storage-docker-summary {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 1rem;
        }

        .storage-docker-summary h4 {
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .docker-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .docker-stat {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0.6rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 0.8rem;
        }

        .docker-stat .label {
            opacity: 0.6;
        }

        .docker-stat .value {
            font-weight: 500;
            color: #64c8ff;
        }

        .storage-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 900px) {
            .storage-details {
                grid-template-columns: 1fr;
            }
        }

        .storage-containers, .storage-volumes {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 1rem;
        }

        .storage-containers h4, .storage-volumes h4 {
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .container-list, .volume-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .container-item, .volume-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.6rem 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .container-item:hover, .volume-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(100, 200, 255, 0.2);
        }

        .container-name, .volume-name {
            font-weight: 500;
            color: #e8e8e8;
        }

        .container-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.running {
            background: #4caf50;
            box-shadow: 0 0 6px rgba(76, 175, 80, 0.5);
        }

        .status-dot.stopped {
            background: #f44336;
        }

        .container-size, .volume-driver {
            font-size: 0.75rem;
            opacity: 0.6;
        }

        .storage-loading {
            text-align: center;
            padding: 2rem;
            opacity: 0.5;
            font-size: 0.9rem;
        }

        footer {
            text-align: center;
            padding: 1.5rem;
            opacity: 0.5;
            font-size: 0.8rem;
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 8px;
            border-left: 4px solid #64c8ff;
            display: none;
            z-index: 1000;
        }

        .toast.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-overlay.show {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #e8e8e8;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #e8e8e8;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .category-group {
            margin-bottom: 1.5rem;
        }

        .category-group:last-child {
            margin-bottom: 0;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .category-icon {
            font-size: 1.2rem;
        }

        .category-name {
            font-size: 1rem;
            font-weight: 600;
            color: #64c8ff;
        }

        .category-count {
            background: rgba(100, 200, 255, 0.2);
            color: #64c8ff;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .symbols-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .symbol-chip {
            background: rgba(255, 255, 255, 0.08);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.8rem;
            color: #e8e8e8;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s;
        }

        .symbol-chip:hover {
            background: rgba(100, 200, 255, 0.15);
            border-color: rgba(100, 200, 255, 0.3);
        }

        .modal-summary {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .summary-stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            text-align: center;
            min-width: 100px;
        }

        .summary-stat .value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #64c8ff;
        }

        .summary-stat .label {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }

        .clickable-symbol-count {
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px;
            padding: 0.15rem 0.5rem;
            margin: 0 -4px;
            background: rgba(100, 200, 255, 0.1);
            border: 1px solid rgba(100, 200, 255, 0.2);
            color: #64c8ff;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .clickable-symbol-count::after {
            content: '\25B6';
            font-size: 0.6rem;
            opacity: 0.7;
        }

        .clickable-symbol-count:hover {
            background: rgba(100, 200, 255, 0.25);
            border-color: rgba(100, 200, 255, 0.4);
            color: #fff;
            transform: translateX(2px);
        }

        .clickable-symbol-count:hover::after {
            opacity: 1;
        }

        .modal-loading {
            text-align: center;
            padding: 3rem;
            color: #64c8ff;
        }

        .modal-loading .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(100, 200, 255, 0.2);
            border-top-color: #64c8ff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>KI Trading Model</h1>
            <div class="header-status">
                <span id="services-count">Services: -/8</span>
                <span id="last-update">Update: -</span>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="services-grid">
            <!-- EasyInsight API -->
            <div class="service-card" id="easyinsight-card">
                <div class="service-header">
                    <h2>EasyInsight API</h2>
                    <span class="status-badge status-loading" id="easyinsight-status">Laden...</span>
                </div>
                <p>Externe Datenquelle - OHLCV-Marktdaten und Symbol-Informationen via TimescaleDB.</p>
                <div class="service-info" id="easyinsight-info">
                    <div><span class="label">Host</span><span>10.1.19.102:3000</span></div>
                    <div><span class="label">Symbole</span><span id="easyinsight-symbols" class="clickable-symbol-count" onclick="openSymbolsModal()" title="Klicken f端r Details">-</span></div>
                    <div><span class="label">Latenz</span><span id="easyinsight-latency">-</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-easyinsight.html" target="_blank">Info</a>
                    <a href="http://10.1.19.102:3000/swagger/" target="_blank">API Docs</a>
                    <a href="http://10.1.19.102:3000" target="_blank">Cockpit</a>
                </div>
            </div>

            <!-- Data Service -->
            <div class="service-card" id="data-card">
                <div class="service-header">
                    <h2>Data Service</h2>
                    <span class="status-badge status-loading" id="data-status">Laden...</span>
                </div>
                <p>Symbol-Management, Trading-Strategien und Daten-Synchronisation mit EasyInsight.</p>
                <div class="service-info" id="data-info">
                    <div><span class="label">Port</span><span>3001</span></div>
                    <div><span class="label">EasyInsight</span><span id="data-easyinsight">-</span></div>
                    <div><span class="label">Sync</span><span id="data-sync">-</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-data.html" target="_blank">Info</a>
                    <a href="/data/docs" target="_blank">API Docs</a>
                    <a href="/config-data.html" target="_blank">Config</a>
                </div>
            </div>

            <!-- NHITS Service -->
            <div class="service-card" id="nhits-card">
                <div class="service-header">
                    <h2>NHITS Service</h2>
                    <span class="status-badge status-loading" id="nhits-status">Laden...</span>
                </div>
                <p>Neural Hierarchical Interpolation for Time Series - Preisprognosen und Modell-Training.</p>
                <div class="service-info" id="nhits-info">
                    <div><span class="label">Port</span><span>3002</span></div>
                    <div><span class="label">GPU</span><span id="nhits-gpu">-</span></div>
                    <div><span class="label">Training</span><span id="nhits-training">-</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-nhits.html" target="_blank">Info</a>
                    <a href="/nhits/docs" target="_blank">API Docs</a>
                    <a href="/config-nhits.html" target="_blank">Config</a>
                </div>
            </div>

            <!-- TCN-Pattern Service -->
            <div class="service-card" id="tcn-card">
                <div class="service-header">
                    <h2>TCN-Pattern</h2>
                    <span class="status-badge status-loading" id="tcn-status">Laden...</span>
                </div>
                <p>Temporal Convolutional Network - Erkennung von 16 Chart-Pattern Typen mit Deep Learning.</p>
                <div class="service-info" id="tcn-info">
                    <div><span class="label">Port</span><span>3005</span></div>
                    <div><span class="label">GPU</span><span id="tcn-gpu">-</span></div>
                    <div><span class="label">Pattern</span><span id="tcn-patterns">16 Typen</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-tcn.html" target="_blank">Info</a>
                    <a href="/tcn/docs" target="_blank">API Docs</a>
                </div>
            </div>

            <!-- HMM-Regime Service -->
            <div class="service-card" id="hmm-card">
                <div class="service-header">
                    <h2>HMM-Regime</h2>
                    <span class="status-badge status-loading" id="hmm-status">Laden...</span>
                </div>
                <p>Hidden Markov Model + LightGBM - Regime-Erkennung und Signal-Scoring f端r Trading.</p>
                <div class="service-info" id="hmm-info">
                    <div><span class="label">Port</span><span>3006</span></div>
                    <div><span class="label">Regimes</span><span id="hmm-regimes">4 States</span></div>
                    <div><span class="label">Scorer</span><span id="hmm-scorer">-</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-hmm.html" target="_blank">Info</a>
                    <a href="/hmm/docs" target="_blank">API Docs</a>
                </div>
            </div>

            <!-- Embedder Service -->
            <div class="service-card" id="embedder-card">
                <div class="service-header">
                    <h2>Embedder</h2>
                    <span class="status-badge status-loading" id="embedder-status">Laden...</span>
                </div>
                <p>Zentraler Embedding-Service - Text, FinBERT, TimeSeries und Feature Embeddings.</p>
                <div class="service-info" id="embedder-info">
                    <div><span class="label">Port</span><span>3007</span></div>
                    <div><span class="label">GPU</span><span id="embedder-gpu">-</span></div>
                    <div><span class="label">Modelle</span><span id="embedder-models">4 Types</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-embedder.html" target="_blank">Info</a>
                    <a href="/embedder/docs" target="_blank">API Docs</a>
                </div>
            </div>

            <!-- RAG Service -->
            <div class="service-card" id="rag-card">
                <div class="service-header">
                    <h2>RAG Service</h2>
                    <span class="status-badge status-loading" id="rag-status">Laden...</span>
                </div>
                <p>Vector Search & Knowledge Base - FAISS-basierte Dokumentensuche und Retrieval.</p>
                <div class="service-info" id="rag-info">
                    <div><span class="label">Port</span><span>3003</span></div>
                    <div><span class="label">Dokumente</span><span id="rag-docs">-</span></div>
                    <div><span class="label">GPU</span><span id="rag-gpu">-</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-rag.html" target="_blank">Info</a>
                    <a href="/rag/docs" target="_blank">API Docs</a>
                    <a href="/config-rag.html" target="_blank">Config</a>
                </div>
            </div>

            <!-- LLM Service -->
            <div class="service-card" id="llm-card">
                <div class="service-header">
                    <h2>LLM Service</h2>
                    <span class="status-badge status-loading" id="llm-status">Laden...</span>
                </div>
                <p>Large Language Model Analyse mit RAG - Trading-Insights powered by Llama 3.1 70B.</p>
                <div class="service-info" id="llm-info">
                    <div><span class="label">Port</span><span>3004</span></div>
                    <div><span class="label">Modell</span><span id="llm-model">-</span></div>
                    <div><span class="label">RAG</span><span id="llm-rag">-</span></div>
                </div>
                <div class="service-links">
                    <a href="/service-llm.html" target="_blank">Info</a>
                    <a href="/llm/docs" target="_blank">API Docs</a>
                    <a href="/config-llm.html" target="_blank">Config</a>
                </div>
            </div>
        </div>

        <!-- System Metrics Section -->
        <div class="metrics-section">
            <!-- CPU & Memory Card -->
            <div class="metric-card" id="cpu-card">
                <h3><span class="metric-icon">&#128187;</span> CPU & Arbeitsspeicher</h3>

                <div style="margin-bottom: 0.5rem; font-size: 0.85rem; opacity: 0.8;">CPU-Auslastung</div>
                <div class="metric-bar-container">
                    <div class="metric-bar cpu" id="cpu-bar" style="width: 0%">
                        <span id="cpu-percent">-</span>
                    </div>
                </div>

                <div style="margin-bottom: 0.5rem; font-size: 0.85rem; opacity: 0.8;">Arbeitsspeicher</div>
                <div class="metric-bar-container">
                    <div class="metric-bar memory" id="memory-bar" style="width: 0%">
                        <span id="memory-percent">-</span>
                    </div>
                </div>

                <div class="metric-details">
                    <div class="metric-detail">
                        <span class="label">CPU Kerne</span>
                        <span class="value" id="cpu-cores">-</span>
                    </div>
                    <div class="metric-detail">
                        <span class="label">Frequenz</span>
                        <span class="value" id="cpu-freq">-</span>
                    </div>
                    <div class="metric-detail">
                        <span class="label">RAM gesamt</span>
                        <span class="value" id="memory-total">-</span>
                    </div>
                    <div class="metric-detail">
                        <span class="label">RAM verwendet</span>
                        <span class="value" id="memory-used">-</span>
                    </div>
                </div>
            </div>

            <!-- GPU Card -->
            <div class="metric-card" id="gpu-card">
                <h3><span class="metric-icon">&#127918;</span> GPU</h3>
                <div id="gpu-content">
                    <div style="margin-bottom: 0.5rem; font-size: 0.85rem; opacity: 0.8;">GPU-Auslastung</div>
                    <div class="metric-bar-container">
                        <div class="metric-bar gpu" id="gpu-bar" style="width: 0%">
                            <span id="gpu-percent">-</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 0.5rem; font-size: 0.85rem; opacity: 0.8;">GPU-Speicher</div>
                    <div class="metric-bar-container">
                        <div class="metric-bar gpu-memory" id="gpu-memory-bar" style="width: 0%">
                            <span id="gpu-memory-percent">-</span>
                        </div>
                    </div>

                    <div class="metric-details">
                        <div class="metric-detail" style="grid-column: span 2;">
                            <span class="label">Modell</span>
                            <span class="value" id="gpu-name">-</span>
                        </div>
                        <div class="metric-detail">
                            <span class="label">VRAM gesamt</span>
                            <span class="value" id="gpu-memory-total">-</span>
                        </div>
                        <div class="metric-detail">
                            <span class="label">VRAM verwendet</span>
                            <span class="value" id="gpu-memory-allocated">-</span>
                        </div>
                    </div>
                </div>
                <div id="gpu-unavailable" class="gpu-unavailable" style="display: none;">
                    Keine GPU verf端gbar
                </div>
            </div>
        </div>

        <!-- Storage Section -->
        <div class="storage-section">
            <div class="storage-card">
                <h3><span class="metric-icon">&#128190;</span> Storage</h3>

                <!-- Overview: Disk + Docker Summary -->
                <div class="storage-overview">
                    <!-- Disk Usage -->
                    <div class="storage-disk">
                        <h4>&#128421; Festplattenspeicher</h4>
                        <div class="metric-bar-container">
                            <div class="metric-bar disk" id="disk-bar" style="width: 0%">
                                <span id="disk-percent">-</span>
                            </div>
                        </div>
                        <div class="metric-details">
                            <div class="metric-detail">
                                <span class="label">Gesamt</span>
                                <span class="value" id="disk-total">-</span>
                            </div>
                            <div class="metric-detail">
                                <span class="label">Verwendet</span>
                                <span class="value" id="disk-used">-</span>
                            </div>
                            <div class="metric-detail">
                                <span class="label">Verf端gbar</span>
                                <span class="value" id="disk-free">-</span>
                            </div>
                            <div class="metric-detail">
                                <span class="label">Auslastung</span>
                                <span class="value" id="disk-percent-text">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- App Storage Summary -->
                    <div class="storage-docker-summary">
                        <h4>&#128451; Anwendungsdaten</h4>
                        <div class="docker-stats-grid">
                            <div class="docker-stat">
                                <span class="label">Modelle</span>
                                <span class="value" id="storage-models-size">-</span>
                            </div>
                            <div class="docker-stat">
                                <span class="label">Logs</span>
                                <span class="value" id="storage-logs-size">-</span>
                            </div>
                            <div class="docker-stat">
                                <span class="label">Daten</span>
                                <span class="value" id="storage-data-size">-</span>
                            </div>
                            <div class="docker-stat">
                                <span class="label">Gesamt</span>
                                <span class="value" id="storage-total-size">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Details: Containers + Volumes -->
                <div class="storage-details">
                    <!-- Containers -->
                    <div class="storage-containers">
                        <h4>&#128230; Container</h4>
                        <div class="container-list" id="container-list">
                            <div class="storage-loading">Lade Container...</div>
                        </div>
                    </div>

                    <!-- Volumes -->
                    <div class="storage-volumes">
                        <h4>&#128451; Volumes</h4>
                        <div class="volume-list" id="volume-list">
                            <div class="storage-loading">Lade Volumes...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <footer>
        KI Trading Model v2.0.0 | Microservices Architecture | FastAPI + NHITS + Llama 3.1 70B + RAG
    </footer>

    <!-- Symbols Modal -->
    <div class="modal-overlay" id="symbols-modal" onclick="closeSymbolsModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>EasyInsight Symbole nach Kategorie</h2>
                <button class="modal-close" onclick="closeSymbolsModal()">&times;</button>
            </div>
            <div class="modal-body" id="symbols-modal-content">
                <div class="modal-loading">
                    <div class="spinner"></div>
                    <div>Symbole werden geladen...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const API_BASE = '';  // Relative URLs via nginx proxy

        let healthyServices = 0;

        async function checkHealth(service, port, statusId) {
            try {
                const res = await fetch(`/${service}/health`);
                const data = await res.json();

                const statusEl = document.getElementById(statusId);
                statusEl.textContent = data.status === 'healthy' ? 'Online' : 'Degraded';
                statusEl.className = `status-badge ${data.status === 'healthy' ? 'status-healthy' : 'status-unhealthy'}`;

                if (data.status === 'healthy') healthyServices++;

                return data;
            } catch (err) {
                const statusEl = document.getElementById(statusId);
                statusEl.textContent = 'Offline';
                statusEl.className = 'status-badge status-unhealthy';
                return null;
            }
        }

        async function updateNhitsInfo() {
            const data = await checkHealth('nhits', 3002, 'nhits-status');
            if (data) {
                document.getElementById('nhits-gpu').textContent = data.gpu_enabled ? 'Aktiviert' : 'CPU';
                document.getElementById('nhits-training').textContent = data.training_in_progress ? 'Aktiv' : 'Inaktiv';
            }

        }

        async function updateLlmInfo() {
            const data = await checkHealth('llm', 3004, 'llm-status');
            if (data) {
                document.getElementById('llm-model').textContent = data.llm_model || '-';
                document.getElementById('llm-rag').textContent = data.rag_enabled ? 'Aktiviert' : 'Deaktiviert';
            }
        }

        async function updateDataInfo() {
            const data = await checkHealth('data', 3001, 'data-status');
            if (data) {
                document.getElementById('data-easyinsight').textContent = data.easyinsight_api ? 'Verbunden' : '-';
                document.getElementById('data-sync').textContent = data.sync_service_status || '-';
            }
        }

        async function updateRagInfo() {
            const data = await checkHealth('rag', 3003, 'rag-status');
            if (data) {
                document.getElementById('rag-docs').textContent = data.document_count || 0;
                document.getElementById('rag-gpu').textContent = data.faiss_gpu ? 'Aktiviert' : 'CPU';
            }
        }

        async function updateTcnInfo() {
            const data = await checkHealth('tcn', 3005, 'tcn-status');
            if (data) {
                document.getElementById('tcn-gpu').textContent = data.gpu_available ? 'Aktiviert' : 'CPU';
            }
        }

        async function updateHmmInfo() {
            const data = await checkHealth('hmm', 3006, 'hmm-status');
            if (data) {
                document.getElementById('hmm-scorer').textContent = data.lightgbm_available ? 'Bereit' : '-';
            }
        }

        async function updateEmbedderInfo() {
            const data = await checkHealth('embedder', 3007, 'embedder-status');
            if (data) {
                document.getElementById('embedder-gpu').textContent = data.gpu_available ? 'Aktiviert' : 'CPU';
            }
        }

        async function updateEasyInsightInfo() {
            const statusEl = document.getElementById('easyinsight-status');
            const symbolsEl = document.getElementById('easyinsight-symbols');
            const latencyEl = document.getElementById('easyinsight-latency');

            try {
                const startTime = performance.now();
                const res = await fetch('/easyinsight/api/symbols');
                const latency = Math.round(performance.now() - startTime);

                if (res.ok) {
                    const symbols = await res.json();
                    statusEl.textContent = 'Online';
                    statusEl.className = 'status-badge status-healthy';
                    symbolsEl.textContent = symbols.length;
                    latencyEl.textContent = `${latency}ms`;
                    healthyServices++;
                } else {
                    throw new Error('API returned error');
                }
            } catch (err) {
                statusEl.textContent = 'Offline';
                statusEl.className = 'status-badge status-unhealthy';
                symbolsEl.textContent = '-';
                latencyEl.textContent = '-';
            }
        }

        async function updateSystemMetrics() {
            try {
                const res = await fetch('/nhits/api/v1/system/metrics');
                if (!res.ok) throw new Error('Metrics fetch failed');
                const data = await res.json();

                // Helper function to determine bar color class based on percentage
                function getColorClass(percent) {
                    if (percent >= 90) return 'high';
                    if (percent >= 70) return 'medium';
                    return '';
                }

                // CPU metrics
                if (data.cpu) {
                    const cpuPercent = Math.round(data.cpu.percent || 0);
                    const cpuBar = document.getElementById('cpu-bar');
                    cpuBar.style.width = `${Math.max(cpuPercent, 5)}%`;
                    cpuBar.className = `metric-bar cpu ${getColorClass(cpuPercent)}`;
                    document.getElementById('cpu-percent').textContent = `${cpuPercent}%`;
                    document.getElementById('cpu-cores').textContent =
                        `${data.cpu.cores_physical || '-'} / ${data.cpu.cores_logical || '-'}`;
                    document.getElementById('cpu-freq').textContent =
                        data.cpu.frequency_mhz ? `${Math.round(data.cpu.frequency_mhz)} MHz` : '-';
                }

                // Memory metrics
                if (data.memory) {
                    const memPercent = Math.round(data.memory.percent || 0);
                    const memBar = document.getElementById('memory-bar');
                    memBar.style.width = `${Math.max(memPercent, 5)}%`;
                    memBar.className = `metric-bar memory ${getColorClass(memPercent)}`;
                    document.getElementById('memory-percent').textContent = `${memPercent}%`;
                    document.getElementById('memory-total').textContent = `${data.memory.total_gb} GB`;
                    document.getElementById('memory-used').textContent = `${data.memory.used_gb} GB`;
                }

                // GPU metrics
                const gpuContent = document.getElementById('gpu-content');
                const gpuUnavailable = document.getElementById('gpu-unavailable');

                if (data.gpu && data.gpu.available) {
                    gpuContent.style.display = 'block';
                    gpuUnavailable.style.display = 'none';

                    // GPU utilization
                    const gpuPercent = data.gpu.utilization_percent !== null
                        ? Math.round(data.gpu.utilization_percent)
                        : null;
                    const gpuBar = document.getElementById('gpu-bar');
                    if (gpuPercent !== null) {
                        gpuBar.style.width = `${Math.max(gpuPercent, 5)}%`;
                        gpuBar.className = `metric-bar gpu ${getColorClass(gpuPercent)}`;
                        document.getElementById('gpu-percent').textContent = `${gpuPercent}%`;
                    } else {
                        gpuBar.style.width = '0%';
                        document.getElementById('gpu-percent').textContent = 'N/A';
                    }

                    // GPU memory
                    const gpuMemPercent = Math.round(data.gpu.memory_percent || 0);
                    const gpuMemBar = document.getElementById('gpu-memory-bar');
                    gpuMemBar.style.width = `${Math.max(gpuMemPercent, 5)}%`;
                    gpuMemBar.className = `metric-bar gpu-memory ${getColorClass(gpuMemPercent)}`;
                    document.getElementById('gpu-memory-percent').textContent = `${gpuMemPercent}%`;

                    document.getElementById('gpu-name').textContent = data.gpu.name || '-';
                    document.getElementById('gpu-memory-total').textContent = `${data.gpu.memory_total_gb} GB`;
                    document.getElementById('gpu-memory-allocated').textContent = `${data.gpu.memory_allocated_gb} GB`;
                } else {
                    gpuContent.style.display = 'none';
                    gpuUnavailable.style.display = 'block';
                }

            } catch (err) {
                console.error('System metrics error:', err);
            }
        }

        async function updateStorageMetrics() {
            try {
                const res = await fetch('/nhits/api/v1/system/storage');
                if (!res.ok) throw new Error('Storage metrics fetch failed');
                const data = await res.json();

                // Helper function to determine bar color class based on percentage
                function getColorClass(percent) {
                    if (percent >= 90) return 'high';
                    if (percent >= 70) return 'medium';
                    return '';
                }

                // Disk metrics
                if (data.disk) {
                    const diskPercent = Math.round(data.disk.percent || 0);
                    const diskBar = document.getElementById('disk-bar');
                    diskBar.style.width = `${Math.max(diskPercent, 5)}%`;
                    diskBar.className = `metric-bar disk ${getColorClass(diskPercent)}`;
                    document.getElementById('disk-percent').textContent = `${diskPercent}%`;
                    document.getElementById('disk-total').textContent = `${data.disk.total_gb} GB`;
                    document.getElementById('disk-used').textContent = `${data.disk.used_gb} GB`;
                    document.getElementById('disk-free').textContent = `${data.disk.free_gb} GB`;
                    document.getElementById('disk-percent-text').textContent = `${diskPercent}%`;
                }

                // App storage summary
                if (data.app_storage && data.app_storage.usage) {
                    document.getElementById('storage-models-size').textContent = data.app_storage.usage.models_size || '-';
                    document.getElementById('storage-logs-size').textContent = data.app_storage.usage.logs_size || '-';
                    document.getElementById('storage-data-size').textContent = data.app_storage.usage.total_data_size || '-';
                    document.getElementById('storage-total-size').textContent = data.app_storage.usage.app_data_size || '-';
                }

                // Containers list - use data from API with health check status
                const containerList = document.getElementById('container-list');
                if (data.app_storage && data.app_storage.containers && data.app_storage.containers.length > 0) {
                    // Map container names to health status elements
                    const healthMap = {
                        'trading-nhits': 'nhits-status',
                        'trading-data': 'data-status',
                        'trading-rag': 'rag-status',
                        'trading-llm': 'llm-status',
                        'trading-frontend': null  // Always healthy if we're seeing this
                    };

                    containerList.innerHTML = data.app_storage.containers.map(container => {
                        const statusEl = healthMap[container.name];
                        const isHealthy = statusEl
                            ? document.getElementById(statusEl)?.textContent === 'Online'
                            : true;
                        return `
                            <div class="container-item">
                                <div>
                                    <div class="container-name">${container.name}</div>
                                    <div class="container-size">${container.service} (Port ${container.port})</div>
                                </div>
                                <div class="container-status">
                                    <span class="status-dot ${isHealthy ? 'running' : 'stopped'}"></span>
                                    <span>${isHealthy ? 'Running' : 'Stopped'}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    containerList.innerHTML = '<div class="storage-loading">Keine Container-Daten</div>';
                }

                // Volumes list
                const volumeList = document.getElementById('volume-list');
                if (data.app_storage && data.app_storage.volumes && data.app_storage.volumes.length > 0) {
                    volumeList.innerHTML = data.app_storage.volumes.map(volume => `
                        <div class="volume-item">
                            <div>
                                <div class="volume-name">${volume.name}</div>
                                <div class="container-size">${volume.path}</div>
                            </div>
                            <div class="volume-driver">${volume.size}</div>
                        </div>
                    `).join('');
                } else {
                    volumeList.innerHTML = '<div class="storage-loading">Keine Volume-Daten</div>';
                }

            } catch (err) {
                console.error('Storage metrics error:', err);
                document.getElementById('container-list').innerHTML = '<div class="storage-loading">Fehler beim Laden</div>';
                document.getElementById('volume-list').innerHTML = '<div class="storage-loading">Fehler beim Laden</div>';
            }
        }

        async function refreshStatus() {
            healthyServices = 0;
            await Promise.all([
                updateNhitsInfo(),
                updateLlmInfo(),
                updateDataInfo(),
                updateRagInfo(),
                updateTcnInfo(),
                updateHmmInfo(),
                updateEmbedderInfo(),
                updateEasyInsightInfo(),
                updateSystemMetrics(),
                updateStorageMetrics()
            ]);

            document.getElementById('services-count').textContent = `Services: ${healthyServices}/8`;
            document.getElementById('last-update').textContent = `Update: ${new Date().toLocaleTimeString('de-DE')}`;
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Symbol Modal Functions
        let cachedSymbols = null;

        // Category info mapping - uses EasyInsight API categories as master
        const categoryInfo = {
            'Forex': { icon: '\u{1F4B1}', name: 'Forex', order: 1 },
            'Crypto': { icon: '\u{1FA99}', name: 'Krypto', order: 2 },
            'Indices': { icon: '\u{1F4CA}', name: 'Indizes', order: 3 },
            'Metals': { icon: '\u{1F947}', name: 'Metalle', order: 4 },
            'Extra': { icon: '\u{2B50}', name: 'Extra', order: 5 },
            'Other': { icon: '\u{2753}', name: 'Sonstige', order: 99 }
        };

        function groupSymbolsByCategory(symbols) {
            const groups = {};

            symbols.forEach(symbolData => {
                // Use category from API directly
                const symbol = symbolData.symbol || symbolData;
                const category = symbolData.category || 'Other';

                if (!groups[category]) {
                    groups[category] = [];
                }
                groups[category].push(symbol);
            });

            // Sort symbols within each category
            Object.keys(groups).forEach(cat => {
                groups[cat].sort();
            });

            return groups;
        }

        function renderSymbolsModal(symbols) {
            const groups = groupSymbolsByCategory(symbols);
            const content = document.getElementById('symbols-modal-content');

            // Summary stats
            let html = '<div class="modal-summary">';
            html += `<div class="summary-stat"><div class="value">${symbols.length}</div><div class="label">Gesamt</div></div>`;

            const sortedCategories = Object.keys(groups).sort((a, b) =>
                (categoryInfo[a]?.order || 99) - (categoryInfo[b]?.order || 99)
            );

            sortedCategories.forEach(cat => {
                const info = categoryInfo[cat] || { icon: '\u2753', name: cat };
                html += `<div class="summary-stat"><div class="value">${groups[cat].length}</div><div class="label">${info.icon} ${info.name}</div></div>`;
            });
            html += '</div>';

            // Category groups
            sortedCategories.forEach(cat => {
                const info = categoryInfo[cat] || { icon: '\u2753', name: cat };
                const symbolsList = groups[cat];

                html += `
                    <div class="category-group">
                        <div class="category-header">
                            <span class="category-icon">${info.icon}</span>
                            <span class="category-name">${info.name}</span>
                            <span class="category-count">${symbolsList.length}</span>
                        </div>
                        <div class="symbols-grid">
                            ${symbolsList.map(s => `<span class="symbol-chip">${s}</span>`).join('')}
                        </div>
                    </div>
                `;
            });

            content.innerHTML = html;
        }

        async function openSymbolsModal() {
            const modal = document.getElementById('symbols-modal');
            const content = document.getElementById('symbols-modal-content');

            // Show modal with loading state
            modal.classList.add('show');
            content.innerHTML = '<div class="modal-loading"><div class="spinner"></div><div>Symbole werden geladen...</div></div>';

            try {
                // Use cached symbols if available
                if (cachedSymbols) {
                    renderSymbolsModal(cachedSymbols);
                    return;
                }

                const res = await fetch('/easyinsight/api/symbols');
                if (res.ok) {
                    cachedSymbols = await res.json();
                    renderSymbolsModal(cachedSymbols);
                } else {
                    content.innerHTML = '<div class="modal-loading"><div>Fehler beim Laden der Symbole</div></div>';
                }
            } catch (err) {
                content.innerHTML = '<div class="modal-loading"><div>Verbindungsfehler: ' + err.message + '</div></div>';
            }
        }

        function closeSymbolsModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('symbols-modal').classList.remove('show');
        }

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeSymbolsModal();
            }
        });

        // Initial load
        refreshStatus();

        // Auto-refresh service status every 10 seconds
        setInterval(refreshStatus, 10000);

        // Update system metrics more frequently (every 3 seconds) for smoother monitoring
        setInterval(updateSystemMetrics, 3000);
    </script>
</body>
</html>
